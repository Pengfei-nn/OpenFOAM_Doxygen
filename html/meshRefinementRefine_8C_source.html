<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>OpenFOAM: src/mesh/snappyHexMesh/meshRefinement/meshRefinementRefine.C Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OpenFOAMlogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="http://openfoam.com">OpenFOAM</a>
   &#160;<span id="projectnumber"><a href="http://openfoam.com/download/source">v1912</a></span>
   </div>
   <div id="projectbrief"><a href="https://develop.openfoam.com">The open source CFD toolbox</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_7be0d8c199b9408ae01f5d77515b8def.html">mesh</a></li><li class="navelem"><a class="el" href="dir_b8488229094ef0b4d530549afea57c74.html">snappyHexMesh</a></li><li class="navelem"><a class="el" href="dir_8ccce68d8eb6c31356e7a13ae3680829.html">meshRefinement</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">meshRefinementRefine.C</div>  </div>
</div><!--header-->
<div class="contents">
<a href="meshRefinementRefine_8C.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*\</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  =========                 |</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">   \\    /   O peration     |</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">    \\  /    A nd           | www.openfoam.com</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">     \\/     M anipulation  |</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">-------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">    Copyright (C) 2011-2017 OpenFOAM Foundation</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">    Copyright (C) 2015-2019 OpenCFD Ltd.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">-------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">License</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">    This file is part of OpenFOAM.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">    OpenFOAM is free software: you can redistribute it and/or modify it</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">    under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">    (at your option) any later version.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">    for more details.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">    You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">    along with OpenFOAM.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">\*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="meshRefinement_8H.html">meshRefinement.H</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trackedParticle_8H.html">trackedParticle.H</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="syncTools_8H.html">syncTools.H</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Time_8H.html">Time.H</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="refinementSurfaces_8H.html">refinementSurfaces.H</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="refinementFeatures_8H.html">refinementFeatures.H</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="shellSurfaces_8H.html">shellSurfaces.H</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="faceSet_8H.html">faceSet.H</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="decompositionMethod_8H.html">decompositionMethod.H</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="fvMeshDistribute_8H.html">fvMeshDistribute.H</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="polyTopoChange_8H.html">polyTopoChange.H</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mapDistributePolyMesh_8H.html">mapDistributePolyMesh.H</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Cloud_8H.html">Cloud.H</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//#include &quot;globalIndex.H&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OBJstream_8H.html">OBJstream.H</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cellSet_8H.html">cellSet.H</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="treeDataCell_8H.html">treeDataCell.H</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cellCuts_8H.html">cellCuts.H</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="refineCell_8H.html">refineCell.H</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hexCellLooper_8H.html">hexCellLooper.H</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="meshCutter_8H.html">meshCutter.H</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="namespaceFoam.html#aa94edac9dd43dd3114964d552001710e">   52</a></span>&#160;<span class="comment">// * * * * * * * * * * * * * * Static Data Members * * * * * * * * * * * * * //</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">namespace </span>Foam</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">//- To compare normals</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="namespaceFoam.html#aa94edac9dd43dd3114964d552001710e">less</a>(<span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; <a class="code" href="LISASMDCalcMethod2_8H.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>, <span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; <a class="code" href="LISASMDCalcMethod1_8H.html#afa8b67a0d5607da908ad92ed485e19e8">y</a>)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#aa6dfcfe3ecf99188a153595df16285bb">direction</a> <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> = 0; <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> &lt; <a class="code" href="classFoam_1_1VectorSpace.html#a6c54998a8606a6180b6b70b7b629ae4e">vector::nComponents</a>; <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>++)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <span class="keywordflow">if</span> (x[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] &lt; y[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>])</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x[i] &gt; y[i])</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        }</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="comment">// All components the same</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="classFoam_1_1normalLess.html">   73</a></span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">//- To compare normals</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keyword">class </span><a class="code" href="classFoam_1_1normalLess.html">normalLess</a></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keyword">const</span> <a class="code" href="classFoam_1_1List.html">vectorList</a>&amp; values_;</div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="classFoam_1_1normalLess.html#a69c8a68d0a59e11d6548df2727a34d4f">   79</a></span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <a class="code" href="classFoam_1_1normalLess.html#a69c8a68d0a59e11d6548df2727a34d4f">normalLess</a>(<span class="keyword">const</span> <a class="code" href="classFoam_1_1List.html">vectorList</a>&amp; <a class="code" href="namespaceFoam_1_1HashTableOps.html#ac4b37690391dc27447cbff9181265054">values</a>)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        :</div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="classFoam_1_1normalLess.html#a1e83d4b24a77ad6e5e2270d6809c6195">   84</a></span>&#160;            values_(values)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        {}</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classFoam_1_1normalLess.html#a1e83d4b24a77ad6e5e2270d6809c6195">operator()</a>(<span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> a, <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> <a class="code" href="namespaceFoam_1_1constant_1_1physicoChemical.html#a00faad9a19c0dc0bcae765415926e925">b</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespaceFoam.html#aa94edac9dd43dd3114964d552001710e">less</a>(values_[a], values_[b]);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    };</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">//- Template specialization for pTraits&lt;labelList&gt; so we can have fields</span></div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="classFoam_1_1pTraits_3_01labelList_01_4.html">   95</a></span>&#160;    <span class="keyword">template</span>&lt;&gt;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">class </span><a class="code" href="classFoam_1_1pTraits.html">pTraits</a>&lt;<a class="code" href="classFoam_1_1List.html">labelList</a>&gt;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="comment">//- Component type</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keyword">typedef</span> <a class="code" href="classFoam_1_1List.html">labelList</a> <a class="code" href="classFoam_1_1List.html">cmptType</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="classFoam_1_1pTraits_3_01labelList_01_4.html#abebfb9b3e2d99469bdc07e76e46a0114">  103</a></span>&#160;    };</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">//- Template specialization for pTraits&lt;labelList&gt; so we can have fields</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keyword">template</span>&lt;&gt;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keyword">class </span><a class="code" href="classFoam_1_1pTraits.html">pTraits</a>&lt;<a class="code" href="classFoam_1_1List.html">vectorList</a>&gt;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="classFoam_1_1pTraits_3_01vectorList_01_4.html">  110</a></span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">//- Component type</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keyword">typedef</span> <a class="code" href="classFoam_1_1List.html">vectorList</a> <a class="code" href="classFoam_1_1List.html">cmptType</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    };</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="classFoam_1_1pTraits_3_01vectorList_01_4.html#ac0c4e05876f7ea4427fb2cea9233911c">  118</a></span>&#160;<span class="comment">// * * * * * * * * * * * * * Private Member Functions  * * * * * * * * * * * //</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">// Get faces (on the new mesh) that have in some way been affected by the</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">// mesh change. Picks up all faces but those that are between two</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">// unrefined faces. (Note that of an unchanged face the edge still might be</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">// split but that does not change any face centre or cell centre.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<a class="code" href="classFoam_1_1List.html">Foam::labelList</a> Foam::meshRefinement::getChangedFaces</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;(</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1mapPolyMesh.html">mapPolyMesh</a>&amp; map,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1List.html">labelList</a>&amp; oldCellsToRefine</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;{</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1polyMesh.html">polyMesh</a>&amp; <a class="code" href="classFoam_1_1meshRefinement.html#a9687e6999ad5ae21072ec74623f049ff">mesh</a> = map.<a class="code" href="classFoam_1_1mapPolyMesh.html#aa51573bc757d5d5bb058db0464886447">mesh</a>();</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="classFoam_1_1List.html">labelList</a> changedFaces;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// For reporting: number of masterFaces changed</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nMasterChanged = 0;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="classFoam_1_1bitSet.html">bitSet</a> isMasterFace(<a class="code" href="classFoam_1_1syncTools.html#a1501f504ab48c2a4825518bba5269ab9">syncTools::getMasterFaces</a>(mesh));</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="comment">// Mark any face on a cell which has been added or changed</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">// Note that refining a face changes the face centre (for a warped face)</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="comment">// which changes the cell centre. This again changes the cellcentre-</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">// cellcentre edge across all faces of the cell.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="comment">// Note: this does not happen for unwarped faces but unfortunately</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// we don&#39;t have this information.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keyword">const</span> <a class="code" href="classFoam_1_1List.html">labelList</a>&amp; faceOwner = mesh.<a class="code" href="classFoam_1_1polyMesh.html#a6d4def83436c9aa4dc68e8e42c5cf268">faceOwner</a>();</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keyword">const</span> <a class="code" href="classFoam_1_1List.html">labelList</a>&amp; faceNeighbour = mesh.<a class="code" href="classFoam_1_1polyMesh.html#ad03ef02786858ab9d5e2776a4731c77c">faceNeighbour</a>();</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keyword">const</span> <a class="code" href="classFoam_1_1List.html">cellList</a>&amp; <a class="code" href="gmvOutputHeader_8H.html#a4f5b52d99e5c7bbb6b34b2f6e27e73d1">cells</a> = mesh.<a class="code" href="classFoam_1_1primitiveMesh.html#a5838384c0cea399b56339f30bc8558ab">cells</a>();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nInternalFaces = mesh.<a class="code" href="classFoam_1_1primitiveMesh.html#a3078ec5cedf6305a3e5781a7d005f0fc">nInternalFaces</a>();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// Mark refined cells on old mesh</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="classFoam_1_1bitSet.html">bitSet</a> oldRefineCell(map.<a class="code" href="classFoam_1_1mapPolyMesh.html#a6a7e1b193949c9f7a78bcbe91147dad8">nOldCells</a>(), oldCellsToRefine);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">// Mark refined faces</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <a class="code" href="classFoam_1_1bitSet.html">bitSet</a> refinedInternalFace(nInternalFaces);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">// 1. Internal faces</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = 0; faceI &lt; nInternalFaces; faceI++)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldOwn = map.<a class="code" href="classFoam_1_1mapPolyMesh.html#a08afe30a689e98e3d34420f8258e573a">cellMap</a>()[faceOwner[faceI]];</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldNei = map.<a class="code" href="classFoam_1_1mapPolyMesh.html#a08afe30a689e98e3d34420f8258e573a">cellMap</a>()[faceNeighbour[faceI]];</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keywordflow">if</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            (</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                oldOwn &gt;= 0 &amp;&amp; !oldRefineCell.test(oldOwn)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;             &amp;&amp; oldNei &gt;= 0 &amp;&amp; !oldRefineCell.test(oldNei)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            )</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                <span class="comment">// Unaffected face since both neighbours were not refined.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                refinedInternalFace.<a class="code" href="classFoam_1_1List.html#a9c583af46074f580ff692170d48899ac">set</a>(faceI);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// 2. Boundary faces</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="classFoam_1_1List.html">boolList</a> refinedBoundaryFace(mesh.<a class="code" href="classFoam_1_1primitiveMesh.html#ac2e4cb144010acc4855a5c909f2167b2">nBoundaryFaces</a>(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(mesh.<a class="code" href="classFoam_1_1polyMesh.html#a6b7f5ba89250dbd7a1c6c7860ab60fe3">boundaryMesh</a>(), patchI)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keyword">const</span> <a class="code" href="classFoam_1_1polyPatch.html">polyPatch</a>&amp; pp = mesh.<a class="code" href="classFoam_1_1polyMesh.html#a6b7f5ba89250dbd7a1c6c7860ab60fe3">boundaryMesh</a>()[patchI];</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = pp.<a class="code" href="classFoam_1_1polyPatch.html#a861f370e41af7d54d7ff91da65de6e6a">start</a>();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp, <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldOwn = map.<a class="code" href="classFoam_1_1mapPolyMesh.html#a08afe30a689e98e3d34420f8258e573a">cellMap</a>()[faceOwner[faceI]];</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <span class="keywordflow">if</span> (oldOwn &gt;= 0 &amp;&amp; !oldRefineCell.test(oldOwn))</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    <span class="comment">// owner did exist and wasn&#39;t refined.</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    refinedBoundaryFace[faceI-nInternalFaces] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                faceI++;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="comment">// Synchronise refined face status</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="classFoam_1_1syncTools.html#aff3eb0f0b83158bb7913499166eb99f7">syncTools::syncBoundaryFaceList</a></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        (</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            mesh,</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            refinedBoundaryFace,</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <a class="code" href="structFoam_1_1orEqOp.html">orEqOp&lt;bool&gt;</a>()</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        );</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">// 3. Mark all faces affected by refinement. Refined faces are in</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">//    - refinedInternalFace</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">//    - refinedBoundaryFace</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <a class="code" href="classFoam_1_1List.html">boolList</a> changedFace(mesh.<a class="code" href="classFoam_1_1primitiveMesh.html#ae1fbe690fc3c47739168a97f79907217">nFaces</a>(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(refinedInternalFace, faceI)</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">if</span> (refinedInternalFace.test(faceI))</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keyword">const</span> <a class="code" href="classFoam_1_1cell.html">cell</a>&amp; ownFaces = cells[faceOwner[faceI]];</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(ownFaces, ownI)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                    changedFace[ownFaces[ownI]] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keyword">const</span> <a class="code" href="classFoam_1_1cell.html">cell</a>&amp; neiFaces = cells[faceNeighbour[faceI]];</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(neiFaces, neiI)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    changedFace[neiFaces[neiI]] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(refinedBoundaryFace, <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">if</span> (refinedBoundaryFace[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>])</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keyword">const</span> <a class="code" href="classFoam_1_1cell.html">cell</a>&amp; ownFaces = cells[faceOwner[i+nInternalFaces]];</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(ownFaces, ownI)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    changedFace[ownFaces[ownI]] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <a class="code" href="classFoam_1_1syncTools.html#a9fcea11b92f314969429f47360a0c8a7">syncTools::syncFaceList</a></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        (</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            mesh,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            changedFace,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <a class="code" href="structFoam_1_1orEqOp.html">orEqOp&lt;bool&gt;</a>()</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        );</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="comment">// Now we have in changedFace marked all affected faces. Pack.</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        changedFaces = findIndices(changedFace, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="comment">// Count changed master faces.</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        nMasterChanged = 0;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(changedFace, faceI)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">if</span> (changedFace[faceI] &amp;&amp; isMasterFace.<a class="code" href="classFoam_1_1bitSet.html#a3218a20f524e7d608e091aee8588dd46">test</a>(faceI))</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                nMasterChanged++;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;<a class="code" href="classFoam_1_1meshRefinement.html#a92dc814ea7fd34acae287945426740d3a0b8403fccaa9b51239c179649c6fcb50">meshRefinement::MESH</a>)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;getChangedFaces : Detected &quot;</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; local:&quot;</span> &lt;&lt; changedFaces.<a class="code" href="classFoam_1_1UList.html#afee03bfededf699921815b2bf3c41e35">size</a>()</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; global:&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nMasterChanged, <a class="code" href="structFoam_1_1sumOp.html">sumOp&lt;label&gt;</a>())</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; changed faces out of &quot;</span> &lt;&lt; mesh.<a class="code" href="classFoam_1_1polyMesh.html#ad152d9d2d71b7bb6ab77c5ef580cb8ee">globalData</a>().<a class="code" href="classFoam_1_1globalMeshData.html#ae81fd4f10de744d66755bdc63b3bba79">nTotalFaces</a>()</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="classFoam_1_1faceSet.html">faceSet</a> changedFacesSet(mesh, <span class="stringliteral">&quot;changedFaces&quot;</span>, changedFaces);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;getChangedFaces : Writing &quot;</span> &lt;&lt; changedFaces.<a class="code" href="classFoam_1_1UList.html#afee03bfededf699921815b2bf3c41e35">size</a>()</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; changed faces to faceSet &quot;</span> &lt;&lt; changedFacesSet.<a class="code" href="classFoam_1_1IOobject.html#a6d60057c26042eaf7fa1b3b6fb07b582">name</a>()</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        changedFacesSet.<a class="code" href="classFoam_1_1regIOobject.html#a1ff0c1446e1074e2d4a6a379857eaa52">write</a>();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">return</span> changedFaces;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">// Mark cell for refinement (if not already marked). Return false if</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">// refinelimit hit. Keeps running count (in nRefine) of cells marked for</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">// refinement</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keywordtype">bool</span> Foam::meshRefinement::markForRefine</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;(</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> markValue,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine,</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; cellValue,</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; nRefine</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;{</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">if</span> (cellValue == -1)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        cellValue = markValue;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        nRefine++;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">return</span> nRefine &lt;= nAllowRefine;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordtype">void</span> Foam::meshRefinement::markFeatureCellLevel</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;(</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; keepPoints,</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; maxFeatureLevel</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// We want to refine all cells containing a feature edge.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">// - don&#39;t want to search over whole mesh</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// - don&#39;t want to build octree for whole mesh</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">// - so use tracking to follow the feature edges</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// 1. find non-manifold points on feature edges (i.e. start of feature edge</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">//    or &#39;knot&#39;)</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">// 2. seed particle starting at keepPoint going to this non-manifold point</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// 3. track particles to their non-manifold point</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// 4. track particles across their connected feature edges, marking all</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">//    visited cells with their level (through trackingData)</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// 5. do 4 until all edges have been visited.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// Find all start cells of features. Is done by tracking from keepPoint.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    Cloud&lt;trackedParticle&gt; startPointCloud</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    (</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        mesh_,</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="stringliteral">&quot;startPointCloud&quot;</span>,</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        IDLList&lt;trackedParticle&gt;()</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    );</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// Features are identical on all processors. Number them so we know</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// what to seed. Do this on only the processor that</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// holds the keepPoint.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a643590f4015338d12714af03d61a0ac9">point</a>&amp; keepPoint : keepPoints)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> celli = mesh_.cellTree().findInside(keepPoint);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">if</span> (celli != -1)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="comment">// I am the processor that holds the keepPoint</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(features_, feati)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <span class="keyword">const</span> edgeMesh&amp; featureMesh = features_[feati];</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> featureLevel = features_.levels()[feati][0];</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a8d042301b1c77516c5bfd527662e4f54">labelListList</a>&amp; pointEdges = featureMesh.pointEdges();</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                <span class="comment">// Find regions on edgeMesh</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> edgeRegion;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nRegions = featureMesh.regions(edgeRegion);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                bitSet regionVisited(nRegions);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="comment">// 1. Seed all &#39;knots&#39; in edgeMesh</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pointEdges, pointi)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    <span class="keywordflow">if</span> (pointEdges[pointi].size() != 2)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;<a class="code" href="classFoam_1_1meshRefinement.html#a92dc814ea7fd34acae287945426740d3a0efd996e92377188d981c034a3952cc7">meshRefinement::FEATURESEEDS</a>)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                        {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                            <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Adding particle from point:&quot;</span> &lt;&lt; pointi</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot; coord:&quot;</span> &lt;&lt; featureMesh.points()[pointi]</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot; since number of emanating edges:&quot;</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                &lt;&lt; pointEdges[pointi].size()</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                                &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                        <span class="comment">// Non-manifold point. Create particle.</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                        startPointCloud.addParticle</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                        (</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                            <span class="keyword">new</span> trackedParticle</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                            (</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                mesh_,</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                keepPoint,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                celli,</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                                featureMesh.points()[pointi],   <span class="comment">// endpos</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                                featureLevel,                   <span class="comment">// level</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                feati,                          <span class="comment">// featureMesh</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                pointi,                         <span class="comment">// end point</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                                -1                              <span class="comment">// feature edge</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                            )</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                        );</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                        <span class="comment">// Mark</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                        <span class="keywordflow">if</span> (pointEdges[pointi].size() &gt; 0)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                        {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> e0 = pointEdges[pointi][0];</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> regioni = edgeRegion[e0];</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                            regionVisited.set(regioni);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                        }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                    }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                <span class="comment">// 2. Any regions that have not been visited at all? These can</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <span class="comment">//    only be circular regions!</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(featureMesh.edges(), edgei)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                    <span class="keywordflow">if</span> (regionVisited.set(edgeRegion[edgei]))</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                    {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                        <span class="keyword">const</span> edge&amp; <a class="code" href="namespaceFoam_1_1constant_1_1electromagnetic.html#a1885f51cb0544664f4e80e895d163fc8">e</a> = featureMesh.edges()[edgei];</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointi = e.start();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;meshRefinement::FEATURESEEDS)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                        {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                            <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Adding particle from point:&quot;</span> &lt;&lt; pointi</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot; coord:&quot;</span> &lt;&lt; featureMesh.points()[pointi]</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot; on circular region:&quot;</span> &lt;&lt; edgeRegion[edgei]</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                                &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                        }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                        <span class="comment">// Non-manifold point. Create particle.</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                        startPointCloud.addParticle</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                        (</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                            <span class="keyword">new</span> trackedParticle</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                            (</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                                mesh_,</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                keepPoint,</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                                celli,</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                                featureMesh.points()[pointi],   <span class="comment">// endpos</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                                featureLevel,                   <span class="comment">// level</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                                feati,                          <span class="comment">// featureMesh</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                                pointi,                         <span class="comment">// end point</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                                -1                              <span class="comment">// feature edge</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                            )</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                        );</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                    }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">// Largest refinement level of any feature passed through</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    maxFeatureLevel = <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>(mesh_.nCells(), -1);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">// Whether edge has been visited.</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    List&lt;bitSet&gt; featureEdgeVisited(features_.size());</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(features_, featI)</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        featureEdgeVisited[featI].setSize(features_[featI].edges().size());</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        featureEdgeVisited[featI] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// Database to pass into trackedParticle::move</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    trackedParticle::trackingData td</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    (</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        startPointCloud,</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        maxFeatureLevel,</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        featureEdgeVisited</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    );</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// Track all particles to their end position (= starting feature point)</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// Note that the particle might have started on a different processor</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">// so this will transfer across nicely until we can start tracking proper.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    scalar maxTrackLen = 2.0*mesh_.bounds().mag();</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;meshRefinement::FEATURESEEDS)</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Tracking &quot;</span> &lt;&lt; startPointCloud.size()</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; particles over distance &quot;</span> &lt;&lt; maxTrackLen</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; to find the starting cell&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    startPointCloud.move(startPointCloud, td, maxTrackLen);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">// Reset levels</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    maxFeatureLevel = -1;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(features_, featI)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        featureEdgeVisited[featI] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    Cloud&lt;trackedParticle&gt; cloud</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    (</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        mesh_,</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="stringliteral">&quot;featureCloud&quot;</span>,</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        IDLList&lt;trackedParticle&gt;()</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    );</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;meshRefinement::FEATURESEEDS)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Constructing cloud for cell marking&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> trackedParticle&amp; startTp : startPointCloud)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> featI = startTp.i();</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI = startTp.j();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keyword">const</span> edgeMesh&amp; featureMesh = features_[featI];</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; pEdges = featureMesh.pointEdges()[pointI];</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="comment">// Now shoot particles down all pEdges.</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pEdges, pEdgeI)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> edgeI = pEdges[pEdgeI];</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <span class="keywordflow">if</span> (featureEdgeVisited[featI].<a class="code" href="foamToVTK_2convertVolumeFields_8H.html#a9501f0803dc8f7696580ce88cb134264">set</a>(edgeI))</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                <span class="comment">// Unvisited edge. Make the particle go to the other point</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <span class="comment">// on the edge.</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                <span class="keyword">const</span> edge&amp; e = featureMesh.edges()[edgeI];</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> otherPointi = e.otherVertex(pointI);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                trackedParticle* tp(<span class="keyword">new</span> trackedParticle(startTp));</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                tp-&gt;start() = tp-&gt;position();</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                tp-&gt;end() = featureMesh.points()[otherPointi];</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                tp-&gt;j() = otherPointi;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                tp-&gt;k() = edgeI;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;meshRefinement::FEATURESEEDS)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                    <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Adding particle for point:&quot;</span> &lt;&lt; pointI</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; coord:&quot;</span> &lt;&lt; tp-&gt;position()</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; feature:&quot;</span> &lt;&lt; featI</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; to track to:&quot;</span> &lt;&lt; tp-&gt;end()</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                        &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                cloud.addParticle(tp);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    startPointCloud.clear();</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="comment">// Track all particles to their end position.</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;meshRefinement::FEATURESEEDS)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Tracking &quot;</span> &lt;&lt; cloud.size()</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; particles over distance &quot;</span> &lt;&lt; maxTrackLen</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; to mark cells&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        cloud.move(cloud, td, maxTrackLen);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="comment">// Make particle follow edge.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keywordflow">for</span> (trackedParticle&amp; tp : cloud)</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        {</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> featI = tp.i();</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI = tp.j();</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="keyword">const</span> edgeMesh&amp; featureMesh = features_[featI];</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; pEdges = featureMesh.pointEdges()[pointI];</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <span class="comment">// Particle now at pointI. Check connected edges to see which one</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <span class="comment">// we have to visit now.</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="keywordtype">bool</span> keepParticle = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pEdges, <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> edgeI = pEdges[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                <span class="keywordflow">if</span> (featureEdgeVisited[featI].<a class="code" href="foamToVTK_2convertVolumeFields_8H.html#a9501f0803dc8f7696580ce88cb134264">set</a>(edgeI))</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                    <span class="comment">// Unvisited edge. Make the particle go to the other point</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                    <span class="comment">// on the edge.</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                    <span class="keyword">const</span> edge&amp; e = featureMesh.edges()[edgeI];</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> otherPointi = e.otherVertex(pointI);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                    tp.start() = tp.position();</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                    tp.end() = featureMesh.points()[otherPointi];</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                    tp.j() = otherPointi;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                    tp.k() = edgeI;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                    keepParticle = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <span class="keywordflow">if</span> (!keepParticle)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                <span class="comment">// Particle at &#39;knot&#39; where another particle already has been</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <span class="comment">// seeded. Delete particle.</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                cloud.deleteParticle(tp);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;meshRefinement::FEATURESEEDS)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Remaining particles &quot;</span> &lt;&lt; cloud.size() &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(cloud.size(), sumOp&lt;label&gt;()) == 0)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">//if (debug&amp;meshRefinement::FEATURESEEDS)</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">//    forAll(maxFeatureLevel, cellI)</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">//    {</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="comment">//        if (maxFeatureLevel[cellI] != -1)</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="comment">//        {</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="comment">//            Pout&lt;&lt; &quot;Feature went through cell:&quot; &lt;&lt; cellI</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="comment">//                &lt;&lt; &quot; coord:&quot; &lt;&lt; mesh_.cellCentres()[cellI]</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="comment">//                &lt;&lt; &quot; level:&quot; &lt;&lt; maxFeatureLevel[cellI]</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">//                &lt;&lt; endl;</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">//        }</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">//    }</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">// Calculates list of cells to refine based on intersection with feature edge.</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a> Foam::meshRefinement::markFeatureRefinement</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;(</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; keepPoints,</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine,</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; refineCell,</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; nRefine</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">// Largest refinement level of any feature passed through</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> maxFeatureLevel;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    markFeatureCellLevel(keepPoints, maxFeatureLevel);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="comment">// See which cells to refine. maxFeatureLevel will hold highest level</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="comment">// of any feature edge that passed through.</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellLevel = meshCutter_.cellLevel();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldNRefine = nRefine;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(maxFeatureLevel, cellI)</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">if</span> (maxFeatureLevel[cellI] &gt; cellLevel[cellI])</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <span class="comment">// Mark</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">if</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            (</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;               !markForRefine</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                (</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                    0,                      <span class="comment">// surface (n/a)</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                    nAllowRefine,</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                    refineCell[cellI],</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                    nRefine</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                )</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            )</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <span class="comment">// Reached limit</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">if</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    (</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      &gt; <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nAllowRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    )</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Reached refinement limit.&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    }</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine-oldNRefine,  sumOp&lt;label&gt;());</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;}</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">// Mark cells for distance-to-feature based refinement.</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a> Foam::meshRefinement::markInternalDistanceToFeatureRefinement</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;(</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine,</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; refineCell,</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; nRefine</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellLevel = meshCutter_.cellLevel();</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; cellCentres = mesh_.cellCentres();</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="comment">// Detect if there are any distance shells</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordflow">if</span> (features_.maxDistance() &lt;= 0.0)</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldNRefine = nRefine;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// Collect cells to test</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> testCc(cellLevel.size()-nRefine);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> testLevels(cellLevel.size()-nRefine);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> testI = 0;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(cellLevel, cellI)</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">if</span> (refineCell[cellI] == -1)</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            testCc[testI] = cellCentres[cellI];</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            testLevels[testI] = cellLevel[cellI];</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            testI++;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        }</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">// Do test to see whether cells are inside/outside shell with higher level</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> maxLevel;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    features_.findHigherLevel(testCc, testLevels, maxLevel);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="comment">// Mark for refinement. Note that we didn&#39;t store the original cellID so</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="comment">// now just reloop in same order.</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    testI = 0;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(cellLevel, cellI)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">if</span> (refineCell[cellI] == -1)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            <span class="keywordflow">if</span> (maxLevel[testI] &gt; testLevels[testI])</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                <span class="keywordtype">bool</span> reachedLimit = !markForRefine</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                (</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                    maxLevel[testI],    <span class="comment">// mark with any positive value</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                    nAllowRefine,</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                    refineCell[cellI],</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                    nRefine</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                );</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                <span class="keywordflow">if</span> (reachedLimit)</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                    {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining internal cells&quot;</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot; since reaching my cell limit of &quot;</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                            &lt;&lt; mesh_.nCells()+7*nRefine &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                    }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            testI++;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        }</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keywordflow">if</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    (</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      &gt; <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nAllowRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    )</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Reached refinement limit.&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine-oldNRefine, sumOp&lt;label&gt;());</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;}</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">// Mark cells for non-surface intersection based refinement.</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a> Foam::meshRefinement::markInternalRefinement</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;(</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine,</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; refineCell,</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; nRefine</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellLevel = meshCutter_.cellLevel();</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; cellCentres = mesh_.cellCentres();</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldNRefine = nRefine;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="comment">// Collect cells to test</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> testCc(cellLevel.size()-nRefine);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> testLevels(cellLevel.size()-nRefine);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> testI = 0;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(cellLevel, cellI)</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">if</span> (refineCell[cellI] == -1)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            testCc[testI] = cellCentres[cellI];</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            testLevels[testI] = cellLevel[cellI];</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            testI++;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="comment">// Do test to see whether cells are inside/outside shell with higher level</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> maxLevel;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    shells_.findHigherLevel(testCc, testLevels, maxLevel);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="comment">// Mark for refinement. Note that we didn&#39;t store the original cellID so</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="comment">// now just reloop in same order.</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    testI = 0;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(cellLevel, cellI)</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="keywordflow">if</span> (refineCell[cellI] == -1)</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        {</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            <span class="keywordflow">if</span> (maxLevel[testI] &gt; testLevels[testI])</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                <span class="keywordtype">bool</span> reachedLimit = !markForRefine</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                (</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                    maxLevel[testI],    <span class="comment">// mark with any positive value</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                    nAllowRefine,</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                    refineCell[cellI],</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                    nRefine</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                );</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                <span class="keywordflow">if</span> (reachedLimit)</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                    {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining internal cells&quot;</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot; since reaching my cell limit of &quot;</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                            &lt;&lt; mesh_.nCells()+7*nRefine &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                    }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            testI++;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">if</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    (</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      &gt; <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nAllowRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    )</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Reached refinement limit.&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    }</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine-oldNRefine, sumOp&lt;label&gt;());</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;}</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a> Foam::meshRefinement::unmarkInternalRefinement</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;(</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; refineCell,</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; nRefine</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellLevel = meshCutter_.cellLevel();</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; cellCentres = mesh_.cellCentres();</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldNRefine = nRefine;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="comment">// Collect cells to test</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> testCc(nRefine);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> testLevels(nRefine);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> testI = 0;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(cellLevel, cellI)</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="keywordflow">if</span> (refineCell[cellI] &gt;= 0)</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            testCc[testI] = cellCentres[cellI];</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            testLevels[testI] = cellLevel[cellI];</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            testI++;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="comment">// Do test to see whether cells are inside/outside shell with higher level</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> levelShell;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    limitShells_.findLevel(testCc, testLevels, levelShell);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="comment">// Mark for refinement. Note that we didn&#39;t store the original cellID so</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="comment">// now just reloop in same order.</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    testI = 0;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(cellLevel, cellI)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keywordflow">if</span> (refineCell[cellI] &gt;= 0)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <span class="keywordflow">if</span> (levelShell[testI] != -1)</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                refineCell[cellI] = -1;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                nRefine--;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            }</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            testI++;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    }</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(oldNRefine-nRefine, sumOp&lt;label&gt;());</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;}</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment">// Collect faces that are intersected and whose neighbours aren&#39;t yet marked</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">// for refinement.</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<a class="code" href="classFoam_1_1List.html">Foam::labelList</a> Foam::meshRefinement::getRefineCandidateFaces</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;(</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; refineCell</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> testFaces(mesh_.nFaces());</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nTest = 0;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; surfIndex = surfaceIndex();</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(surfIndex, faceI)</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    {</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">if</span> (surfIndex[faceI] != -1)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            <span class="keywordflow">if</span> (mesh_.isInternalFace(faceI))</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nei = mesh_.faceNeighbour()[faceI];</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                <span class="keywordflow">if</span> (refineCell[own] == -1 || refineCell[nei] == -1)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                    testFaces[nTest++] = faceI;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                <span class="keywordflow">if</span> (refineCell[own] == -1)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                    testFaces[nTest++] = faceI;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    testFaces.setSize(nTest);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">return</span> testFaces;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;}</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">// Mark cells for surface intersection based refinement.</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a> Foam::meshRefinement::markSurfaceRefinement</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;(</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine,</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; neiLevel,</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; neiCc,</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; refineCell,</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; nRefine</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellLevel = meshCutter_.cellLevel();</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldNRefine = nRefine;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="comment">// Use cached surfaceIndex_ to detect if any intersection. If so</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="comment">// re-intersect to determine level wanted.</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="comment">// Collect candidate faces</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> testFaces(getRefineCandidateFaces(refineCell));</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="comment">// Collect segments</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>(testFaces.size());</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>(testFaces.size());</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> minLevel(testFaces.size());</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    calcCellCellRays</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    (</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        neiCc,</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        neiLevel,</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        testFaces,</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>,</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>,</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        minLevel</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    );</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">// Do test for higher intersections</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> surfaceHit;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> surfaceMinLevel;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    surfaces_.findHigherIntersection</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    (</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        shells_,</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>,</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>,</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        minLevel,</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        surfaceHit,</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        surfaceMinLevel</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    );</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="comment">// Mark cells for refinement</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(testFaces, <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>)</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    {</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = testFaces[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> surfI = surfaceHit[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keywordflow">if</span> (surfI != -1)</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        {</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <span class="comment">// Found intersection with surface with higher wanted</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <span class="comment">// refinement. Check if the level field on that surface</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            <span class="comment">// specifies an even higher level. Note:this is weird. Should</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            <span class="comment">// do the check with the surfaceMinLevel whilst intersecting the</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            <span class="comment">// surfaces?</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;            <span class="keywordflow">if</span> (surfaceMinLevel[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] &gt; cellLevel[own])</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                <span class="comment">// Owner needs refining</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                <span class="keywordflow">if</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                (</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                   !markForRefine</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                    (</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                        surfI,</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                        nAllowRefine,</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                        refineCell[own],</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                        nRefine</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                    )</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                )</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                {</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                }</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            <span class="keywordflow">if</span> (mesh_.isInternalFace(faceI))</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nei = mesh_.faceNeighbour()[faceI];</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                <span class="keywordflow">if</span> (surfaceMinLevel[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] &gt; cellLevel[nei])</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                {</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                    <span class="comment">// Neighbour needs refining</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                    <span class="keywordflow">if</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                    (</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                       !markForRefine</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                        (</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                            surfI,</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                            nAllowRefine,</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                            refineCell[nei],</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                            nRefine</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                        )</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                    )</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                    {</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                    }</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        }</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    }</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">if</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    (</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      &gt; <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nAllowRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    )</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    {</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Reached refinement limit.&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine-oldNRefine, sumOp&lt;label&gt;());</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;}</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">// Count number of matches of first argument in second argument</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a> Foam::meshRefinement::countMatches</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;(</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keyword">const</span> List&lt;point&gt;&amp; normals1,</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keyword">const</span> List&lt;point&gt;&amp; normals2,</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keyword">const</span> scalar tol</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nMatches = 0;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(normals1, <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>)</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a7ea82552101f041fad7635b3ed036a84">vector</a>&amp; n1 = normals1[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(normals2, <a class="code" href="shootRays_8H.html#a26c8668e6da16a9f1bf37a8829e5a7db">j</a>)</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        {</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a7ea82552101f041fad7635b3ed036a84">vector</a>&amp; n2 = normals2[<a class="code" href="shootRays_8H.html#a26c8668e6da16a9f1bf37a8829e5a7db">j</a>];</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam.html#a7e96c2b6f66f356ef358f08e65cb8ace">magSqr</a>(n1-n2) &lt; tol)</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            {</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                nMatches++;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    }</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keywordflow">return</span> nMatches;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;}</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">// Mark cells for surface curvature based refinement.</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a> Foam::meshRefinement::markSurfaceCurvatureRefinement</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;(</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keyword">const</span> scalar curvature,</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine,</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; neiLevel,</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; neiCc,</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; refineCell,</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; nRefine</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellLevel = meshCutter_.cellLevel();</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; cellCentres = mesh_.cellCentres();</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldNRefine = nRefine;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="comment">// 1. local test: any cell on more than one surface gets refined</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="comment">// (if its current level is &lt; max of the surface max level)</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="comment">// 2. &#39;global&#39; test: any cell on only one surface with a neighbour</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="comment">// on a different surface gets refined (if its current level etc.)</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keyword">const</span> bitSet isMasterFace(<a class="code" href="classFoam_1_1syncTools.html#a1501f504ab48c2a4825518bba5269ab9">syncTools::getMasterFaces</a>(mesh_));</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">// Collect candidate faces (i.e. intersecting any surface and</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">// owner/neighbour not yet refined.</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> testFaces(getRefineCandidateFaces(refineCell));</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="comment">// Collect segments</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>(testFaces.size());</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>(testFaces.size());</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> minLevel(testFaces.size());</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="comment">// Note: uses isMasterFace otherwise could be call to calcCellCellRays</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(testFaces, <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>)</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    {</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = testFaces[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">if</span> (mesh_.isInternalFace(faceI))</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        {</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nei = mesh_.faceNeighbour()[faceI];</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] = cellCentres[own];</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] = cellCentres[nei];</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            minLevel[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] = <a class="code" href="namespaceFoam.html#a96b65441175bbfb9a869045dc05fb0b9">min</a>(cellLevel[own], cellLevel[nei]);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        {</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> bFaceI = faceI - mesh_.nInternalFaces();</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;            <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] = cellCentres[own];</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] = neiCc[bFaceI];</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;            <span class="keywordflow">if</span> (!isMasterFace[faceI])</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            {</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                <a class="code" href="namespaceFoam.html#adb8ca783445fee992edbb6129fc12148">Swap</a>(<a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>], <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>[i]);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;            }</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;            minLevel[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] = <a class="code" href="namespaceFoam.html#a96b65441175bbfb9a869045dc05fb0b9">min</a>(cellLevel[own], neiLevel[bFaceI]);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        }</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    }</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="comment">// Extend segments a bit</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    {</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#aa6a94734c26b4f5d0008931862eddcd8">vectorField</a> smallVec(ROOTSMALL*(<a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>-<a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>));</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a> -= smallVec;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a> += smallVec;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    }</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="comment">// Test for all intersections (with surfaces of higher max level than</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="comment">// minLevel) and cache per cell the interesting inter</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <a class="code" href="namespaceFoam.html#a8d042301b1c77516c5bfd527662e4f54">labelListList</a> cellSurfLevels(mesh_.nCells());</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    List&lt;vectorList&gt; cellSurfNormals(mesh_.nCells());</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <span class="comment">// Per segment the normals of the surfaces</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        List&lt;vectorList&gt; surfaceNormal;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        <span class="comment">// Per segment the list of levels of the surfaces</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        <a class="code" href="namespaceFoam.html#a8d042301b1c77516c5bfd527662e4f54">labelListList</a> surfaceLevel;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        surfaces_.findAllIntersections</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        (</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>,</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>,</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            minLevel,           <span class="comment">// max level of surface has to be bigger</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                                <span class="comment">// than min level of neighbouring cells</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>(surfaces_.maxLevel().size(), 0),  <span class="comment">// min level</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            surfaces_.maxLevel(),</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            surfaceNormal,</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            surfaceLevel</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        );</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="comment">// Sort the data according to surface location. This will guarantee</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="comment">// that on coupled faces both sides visit the intersections in</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="comment">// the same order so will decide the same</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> visitOrder;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(surfaceNormal, pointI)</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; pNormals = surfaceNormal[pointI];</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; pLevel = surfaceLevel[pointI];</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            <a class="code" href="namespaceFoam.html#af0edf3acab9a043f9653e0ad5908b38f">sortedOrder</a>(pNormals, visitOrder, normalLess(pNormals));</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;            pNormals = List&lt;point&gt;(pNormals, visitOrder);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            pLevel = <a class="code" href="namespaceFoam.html#ae99c179eee737907d850a9d85d619b6b">labelUIndList</a>(pLevel, visitOrder);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        }</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        <span class="comment">// Clear out unnecessary data</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>.clear();</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>.clear();</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        minLevel.clear();</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <span class="comment">// Convert face-wise data to cell.</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(testFaces, <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        {</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = testFaces[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; fNormals = surfaceNormal[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; fLevels = surfaceLevel[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;            <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(fNormals, hitI)</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;            {</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                <span class="keywordflow">if</span> (fLevels[hitI] &gt; cellLevel[own])</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                {</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                    cellSurfLevels[own].append(fLevels[hitI]);</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                    cellSurfNormals[own].append(fNormals[hitI]);</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                <span class="keywordflow">if</span> (mesh_.isInternalFace(faceI))</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                {</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nei = mesh_.faceNeighbour()[faceI];</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                    <span class="keywordflow">if</span> (fLevels[hitI] &gt; cellLevel[nei])</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                    {</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                        cellSurfLevels[nei].append(fLevels[hitI]);</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                        cellSurfNormals[nei].append(fNormals[hitI]);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                    }</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;            }</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        }</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    }</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="comment">// Bit of statistics</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    {</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nSet = 0;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nNormals = 9;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(cellSurfNormals, cellI)</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        {</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; normals = cellSurfNormals[cellI];</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            <span class="keywordflow">if</span> (normals.size())</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;            {</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                nSet++;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                nNormals += normals.<a class="code" href="classFoam_1_1UList.html#afee03bfededf699921815b2bf3c41e35">size</a>();</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;            }</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        }</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;        <a class="code" href="namespaceFoam.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">reduce</a>(nSet, sumOp&lt;label&gt;());</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <a class="code" href="namespaceFoam.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">reduce</a>(nNormals, sumOp&lt;label&gt;());</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;markSurfaceCurvatureRefinement :&quot;</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; cells:&quot;</span> &lt;&lt; mesh_.globalData().nTotalCells()</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; of which with normals:&quot;</span> &lt;&lt; nSet</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; ; total normals stored:&quot;</span> &lt;&lt; nNormals</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;            &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    }</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keywordtype">bool</span> reachedLimit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="comment">// 1. Check normals per cell</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">for</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    (</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> cellI = 0;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        !reachedLimit &amp;&amp; cellI &lt; cellSurfNormals.size();</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        cellI++</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    )</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    {</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; normals = cellSurfNormals[cellI];</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; levels = cellSurfLevels[cellI];</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <span class="comment">// n^2 comparison of all normals in a cell</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> = 0; !reachedLimit &amp;&amp; <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> &lt; normals.size(); <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>++)</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        {</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> <a class="code" href="shootRays_8H.html#a26c8668e6da16a9f1bf37a8829e5a7db">j</a> = <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>+1; !reachedLimit &amp;&amp; <a class="code" href="shootRays_8H.html#a26c8668e6da16a9f1bf37a8829e5a7db">j</a> &lt; normals.size(); <a class="code" href="shootRays_8H.html#a26c8668e6da16a9f1bf37a8829e5a7db">j</a>++)</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            {</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                <span class="keywordflow">if</span> ((normals[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] &amp; normals[<a class="code" href="shootRays_8H.html#a26c8668e6da16a9f1bf37a8829e5a7db">j</a>]) &lt; curvature)</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                {</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> maxLevel = <a class="code" href="namespaceFoam.html#a0e0c00c14acbabe88eec56a8b0fa2806">max</a>(levels[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>], levels[j]);</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                    <span class="keywordflow">if</span> (cellLevel[cellI] &lt; maxLevel)</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                    {</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                        <span class="keywordflow">if</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                        (</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                            !markForRefine</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                            (</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                                maxLevel,</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                                nAllowRefine,</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                                refineCell[cellI],</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                                nRefine</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                            )</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                        )</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                        {</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                            {</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                                <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining since reaching my cell&quot;</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                                    &lt;&lt; <span class="stringliteral">&quot; limit of &quot;</span> &lt;&lt; mesh_.nCells()+7*nRefine</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                                    &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                            }</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                            reachedLimit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                        }</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                    }</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                }</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            }</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        }</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    }</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="comment">// 2. Find out a measure of surface curvature</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">// Look at normals between neighbouring surfaces</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="comment">// Loop over all faces. Could only be checkFaces, except if they&#39;re coupled</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="comment">// Internal faces</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keywordflow">for</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    (</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = 0;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        !reachedLimit &amp;&amp; faceI &lt; mesh_.nInternalFaces();</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        faceI++</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    )</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    {</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nei = mesh_.faceNeighbour()[faceI];</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; ownNormals = cellSurfNormals[own];</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; ownLevels = cellSurfLevels[own];</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; neiNormals = cellSurfNormals[nei];</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; neiLevels = cellSurfLevels[nei];</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="comment">// Special case: owner normals set is a subset of the neighbour</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <span class="comment">// normals. Do not do curvature refinement since other cell&#39;s normals</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <span class="comment">// do not add any information. Avoids weird corner extensions of</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        <span class="comment">// refinement regions.</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <span class="keywordtype">bool</span> ownIsSubset =</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;            countMatches(ownNormals, neiNormals)</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;         == ownNormals.<a class="code" href="classFoam_1_1UList.html#afee03bfededf699921815b2bf3c41e35">size</a>();</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="keywordtype">bool</span> neiIsSubset =</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            countMatches(neiNormals, ownNormals)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;         == neiNormals.size();</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        <span class="keywordflow">if</span> (!ownIsSubset &amp;&amp; !neiIsSubset)</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        {</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            <span class="comment">// n^2 comparison of between ownNormals and neiNormals</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> = 0; !reachedLimit &amp;&amp;  <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> &lt; ownNormals.size(); <a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>++)</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            {</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> j = 0; !reachedLimit &amp;&amp; j &lt; neiNormals.size(); j++)</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                    <span class="comment">// Have valid data on both sides. Check curvature.</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                    <span class="keywordflow">if</span> ((ownNormals[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] &amp; neiNormals[j]) &lt; curvature)</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                    {</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                        <span class="comment">// See which side to refine.</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                        <span class="keywordflow">if</span> (cellLevel[own] &lt; ownLevels[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>])</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                        {</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;                            <span class="keywordflow">if</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                            (</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                                !markForRefine</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                                (</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;                                    ownLevels[i],</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                                    nAllowRefine,</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                                    refineCell[own],</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                                    nRefine</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;                                )</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                            )</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                            {</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                                {</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                                    <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining since reaching&quot;</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                                        &lt;&lt; <span class="stringliteral">&quot; my cell limit of &quot;</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                                        &lt;&lt; mesh_.nCells()+7*nRefine &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                                }</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                                reachedLimit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                            }</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;                        }</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                        <span class="keywordflow">if</span> (cellLevel[nei] &lt; neiLevels[j])</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                        {</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                            <span class="keywordflow">if</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                            (</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                                !markForRefine</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                                (</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                                    neiLevels[j],</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                                    nAllowRefine,</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                                    refineCell[nei],</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                                    nRefine</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                                )</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                            )</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                            {</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                                {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                                    <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining since reaching&quot;</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                                        &lt;&lt; <span class="stringliteral">&quot; my cell limit of &quot;</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                                        &lt;&lt; mesh_.nCells()+7*nRefine &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                                }</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                                reachedLimit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                            }</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                        }</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                    }</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            }</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        }</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    }</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="comment">// Send over surface normal to neighbour cell.</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    List&lt;vectorList&gt; neiSurfaceNormals;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <a class="code" href="classFoam_1_1syncTools.html#ac509eef6db47b0b87366229f2fb017f9">syncTools::swapBoundaryCellList</a>(mesh_, cellSurfNormals, neiSurfaceNormals);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="comment">// Boundary faces</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordflow">for</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    (</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = mesh_.nInternalFaces();</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        !reachedLimit &amp;&amp; faceI &lt; mesh_.nFaces();</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        faceI++</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    )</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    {</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> bFaceI = faceI - mesh_.nInternalFaces();</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; ownNormals = cellSurfNormals[own];</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; ownLevels = cellSurfLevels[own];</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; neiNormals = neiSurfaceNormals[bFaceI];</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="comment">// Special case: owner normals set is a subset of the neighbour</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        <span class="comment">// normals. Do not do curvature refinement since other cell&#39;s normals</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        <span class="comment">// do not add any information. Avoids weird corner extensions of</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        <span class="comment">// refinement regions.</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="keywordtype">bool</span> ownIsSubset =</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            countMatches(ownNormals, neiNormals)</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;         == ownNormals.<a class="code" href="classFoam_1_1UList.html#afee03bfededf699921815b2bf3c41e35">size</a>();</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <span class="keywordtype">bool</span> neiIsSubset =</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            countMatches(neiNormals, ownNormals)</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;         == neiNormals.size();</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        <span class="keywordflow">if</span> (!ownIsSubset &amp;&amp; !neiIsSubset)</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        {</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            <span class="comment">// n^2 comparison of between ownNormals and neiNormals</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> i = 0; !reachedLimit &amp;&amp;  i &lt; ownNormals.size(); i++)</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            {</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> j = 0; !reachedLimit &amp;&amp; j &lt; neiNormals.size(); j++)</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                {</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                    <span class="comment">// Have valid data on both sides. Check curvature.</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                    <span class="keywordflow">if</span> ((ownNormals[i] &amp; neiNormals[j]) &lt; curvature)</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                    {</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                        <span class="keywordflow">if</span> (cellLevel[own] &lt; ownLevels[i])</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                        {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                            <span class="keywordflow">if</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                            (</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                                !markForRefine</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                                (</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                                    ownLevels[i],</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                                    nAllowRefine,</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;                                    refineCell[own],</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                                    nRefine</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                                )</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                            )</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                            {</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                                {</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                                    <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining since reaching&quot;</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                                        &lt;&lt; <span class="stringliteral">&quot; my cell limit of &quot;</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                                        &lt;&lt; mesh_.nCells()+7*nRefine</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                                        &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                                }</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                                reachedLimit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                            }</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                        }</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                    }</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                }</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            }</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        }</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    }</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordflow">if</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    (</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      &gt; <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nAllowRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    )</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    {</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Reached refinement limit.&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    }</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine-oldNRefine, sumOp&lt;label&gt;());</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;}</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classFoam_1_1meshRefinement.html#a2c7b53bf05093baefe6bbcbeccc12b59">Foam::meshRefinement::isGap</a></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;(</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="keyword">const</span> scalar planarCos,</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a7ea82552101f041fad7635b3ed036a84">vector</a>&amp; point0,</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a7ea82552101f041fad7635b3ed036a84">vector</a>&amp; normal0,</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div>
<div class="line"><a name="l01533"></a><span class="lineno"><a class="line" href="classFoam_1_1meshRefinement.html#a2c7b53bf05093baefe6bbcbeccc12b59"> 1533</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; point1,</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; normal1</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="comment">//- Hits differ and angles are oppositeish and</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <span class="comment">//  hits have a normal distance</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <a class="code" href="classFoam_1_1Vector.html">vector</a> <a class="code" href="heatTransfer_2buoyantPimpleFoam_2overBuoyantPimpleDyMFoam_2correctPhi_8H.html#aa82634858b978d958140338fab813c8b">d</a> = point1-point0;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    scalar magD = <a class="code" href="namespaceFoam.html#a834bb6faa2fd38f3b65634f2e1987e97">mag</a>(d);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="keywordflow">if</span> (magD &gt; mergeDistance())</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    {</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        scalar cosAngle = (normal0 &amp; normal1);</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <a class="code" href="classFoam_1_1Vector.html">vector</a> avg = <a class="code" href="namespaceFoam.html#ab64e5584854aaf645dab58faf8793d20">Zero</a>;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        <span class="keywordflow">if</span> (cosAngle &lt; (-1+planarCos))</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        {</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            <span class="comment">// Opposite normals</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            avg = 0.5*(normal0-normal1);</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        }</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cosAngle &gt; (1-planarCos))</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        {</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            avg = 0.5*(normal0+normal1);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        }</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordflow">if</span> (avg != <a class="code" href="classFoam_1_1VectorSpace.html#a058151225b5fb26e4a5a4f039b0c1fa1">vector::zero</a>)</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        {</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;            avg /= <a class="code" href="namespaceFoam.html#a834bb6faa2fd38f3b65634f2e1987e97">mag</a>(avg);</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            <span class="comment">// Check normal distance of intersection locations</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam.html#a834bb6faa2fd38f3b65634f2e1987e97">mag</a>(avg&amp;d) &gt; mergeDistance())</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;            {</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;            }</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        }</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;}</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">// Mark small gaps</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classFoam_1_1meshRefinement.html#a26f145e291841488338b3c35a60e4dd2">Foam::meshRefinement::isNormalGap</a></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;(</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keyword">const</span> scalar planarCos,</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> level0,</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; point0,</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; normal0,</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> level1,</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; point1,</div>
<div class="line"><a name="l01583"></a><span class="lineno"><a class="line" href="classFoam_1_1meshRefinement.html#a26f145e291841488338b3c35a60e4dd2"> 1583</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; normal1</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="comment">//const scalar edge0Len = meshCutter_.level0EdgeLength();</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <span class="comment">//- Hits differ and angles are oppositeish and</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="comment">//  hits have a normal distance</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <a class="code" href="classFoam_1_1Vector.html">vector</a> <a class="code" href="heatTransfer_2buoyantPimpleFoam_2overBuoyantPimpleDyMFoam_2correctPhi_8H.html#aa82634858b978d958140338fab813c8b">d</a> = point1-point0;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    scalar magD = <a class="code" href="namespaceFoam.html#a834bb6faa2fd38f3b65634f2e1987e97">mag</a>(d);</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="keywordflow">if</span> (magD &gt; mergeDistance())</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    {</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        scalar cosAngle = (normal0 &amp; normal1);</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <a class="code" href="classFoam_1_1Vector.html">vector</a> avgNormal = <a class="code" href="namespaceFoam.html#ab64e5584854aaf645dab58faf8793d20">Zero</a>;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        <span class="keywordflow">if</span> (cosAngle &lt; (-1+planarCos))</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        {</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;            <span class="comment">// Opposite normals</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;            avgNormal = 0.5*(normal0-normal1);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        }</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cosAngle &gt; (1-planarCos))</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        {</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;            avgNormal = 0.5*(normal0+normal1);</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        }</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        <span class="keywordflow">if</span> (avgNormal != <a class="code" href="classFoam_1_1VectorSpace.html#a058151225b5fb26e4a5a4f039b0c1fa1">vector::zero</a>)</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        {</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;            avgNormal /= <a class="code" href="namespaceFoam.html#a834bb6faa2fd38f3b65634f2e1987e97">mag</a>(avgNormal);</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            <span class="comment">//scalar normalDist = mag(d&amp;avgNormal);</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            <span class="comment">//const scalar avgCellSize = edge0Len/pow(2.0, 0.5*(level0+level1));</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;            <span class="comment">//if (normalDist &gt; 1*avgCellSize)</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            <span class="comment">//{</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;            <span class="comment">//    Pout&lt;&lt; &quot;** skipping large distance &quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;            <span class="comment">//    return false;</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            <span class="comment">//}</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            <span class="comment">// Check average normal with respect to intersection locations</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam.html#a834bb6faa2fd38f3b65634f2e1987e97">mag</a>(avgNormal&amp;d/magD) &gt; <a class="code" href="namespaceFoam.html#aebb41a148f7cf44b63e12f69e487e49f">Foam::cos</a>(<a class="code" href="namespaceFoam.html#a29bdf29209233267101e6fc9463dabf1">degToRad</a>(45.0)))</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;            {</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            }</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        }</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    }</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;}</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="keywordtype">bool</span> Foam::meshRefinement::checkProximity</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;(</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keyword">const</span> scalar planarCos,</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine,</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> surfaceLevel,       <span class="comment">// current intersection max level</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; <a class="code" href="classFoam_1_1surfaceLocation.html">surfaceLocation</a>,  <span class="comment">// current intersection location</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; surfaceNormal,    <span class="comment">// current intersection normal</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> cellI,</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; cellMaxLevel,        <span class="comment">// cached max surface level for this cell</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; cellMaxLocation,    <span class="comment">// cached surface location for this cell</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <a class="code" href="classFoam_1_1Vector.html">vector</a>&amp; cellMaxNormal,      <span class="comment">// cached surface normal for this cell</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <a class="code" href="classFoam_1_1List.html">labelList</a>&amp; refineCell,</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; nRefine</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1List.html">labelList</a>&amp; cellLevel = meshCutter_.cellLevel();</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="comment">// Test if surface applicable</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordflow">if</span> (surfaceLevel &gt; cellLevel[cellI])</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    {</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        <span class="keywordflow">if</span> (cellMaxLevel == -1)</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        {</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            <span class="comment">// First visit of cell. Store</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;            cellMaxLevel = surfaceLevel;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            cellMaxLocation = surfaceLocation;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;            cellMaxNormal = surfaceNormal;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        }</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        {</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;            <span class="comment">// Second or more visit.</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            <span class="comment">// Check if</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;            <span class="comment">//  - different location</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;            <span class="comment">//  - opposite surface</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            <span class="keywordtype">bool</span> closeSurfaces = isNormalGap</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;            (</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                planarCos,</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                cellLevel[cellI],   <span class="comment">//cellMaxLevel,</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                cellMaxLocation,</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                cellMaxNormal,</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                cellLevel[cellI],   <span class="comment">//surfaceLevel,</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                surfaceLocation,</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                surfaceNormal</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            );</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;            <span class="comment">// Set normal to that of highest surface. Not really necessary</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;            <span class="comment">// over here but we reuse cellMax info when doing coupled faces.</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;            <span class="keywordflow">if</span> (surfaceLevel &gt; cellMaxLevel)</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            {</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                cellMaxLevel = surfaceLevel;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                cellMaxLocation = surfaceLocation;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                cellMaxNormal = surfaceNormal;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;            }</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            <span class="keywordflow">if</span> (closeSurfaces)</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            {</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                <span class="comment">//Pout&lt;&lt; &quot;Found gap:&quot; &lt;&lt; nl</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                <span class="comment">//    &lt;&lt; &quot;    location:&quot; &lt;&lt; surfaceLocation</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                <span class="comment">//    &lt;&lt; &quot;\tnormal  :&quot; &lt;&lt; surfaceNormal &lt;&lt; nl</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="comment"></span>                <span class="comment">//    &lt;&lt; &quot;\tnormal  :&quot; &lt;&lt; cellMaxNormal &lt;&lt; nl</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                <span class="comment">//    &lt;&lt; &quot;\tcos     :&quot; &lt;&lt; (surfaceNormal&amp;cellMaxNormal) &lt;&lt; nl</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                <span class="comment">//    &lt;&lt; endl;</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                <span class="keywordflow">return</span> markForRefine</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                (</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                    surfaceLevel,   <span class="comment">// mark with any non-neg number.</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                    nAllowRefine,</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                    refineCell[cellI],</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                    nRefine</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                );</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            }</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        }</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    }</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="comment">// Did not reach refinement limit.</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;}</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a> Foam::meshRefinement::markProximityRefinement</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;(</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keyword">const</span> scalar planarCos,</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; surfaceMinLevel,</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; surfaceMaxLevel,</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine,</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; neiLevel,</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; neiCc,</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; refineCell,</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; nRefine</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellLevel = meshCutter_.cellLevel();</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldNRefine = nRefine;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    <span class="comment">// 1. local test: any cell on more than one surface gets refined</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="comment">// (if its current level is &lt; max of the surface max level)</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <span class="comment">// 2. &#39;global&#39; test: any cell on only one surface with a neighbour</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <span class="comment">// on a different surface gets refined (if its current level etc.)</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="comment">// Collect candidate faces (i.e. intersecting any surface and</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="comment">// owner/neighbour not yet refined.</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> testFaces(getRefineCandidateFaces(refineCell));</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="comment">// Collect segments</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>(testFaces.size());</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>(testFaces.size());</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> minLevel(testFaces.size());</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    calcCellCellRays</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    (</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        neiCc,</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        neiLevel,</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        testFaces,</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>,</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>,</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        minLevel</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    );</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="comment">// Test for all intersections (with surfaces of higher gap level than</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="comment">// minLevel) and cache per cell the max surface level and the local normal</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="comment">// on that surface.</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> cellMaxLevel(mesh_.nCells(), -1);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <a class="code" href="namespaceFoam.html#aa6a94734c26b4f5d0008931862eddcd8">vectorField</a> cellMaxNormal(mesh_.nCells(), <a class="code" href="namespaceFoam.html#ab64e5584854aaf645dab58faf8793d20">Zero</a>);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> cellMaxLocation(mesh_.nCells(), <a class="code" href="namespaceFoam.html#ab64e5584854aaf645dab58faf8793d20">Zero</a>);</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    {</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        <span class="comment">// Per segment the normals of the surfaces</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        List&lt;vectorList&gt; surfaceLocation;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        List&lt;vectorList&gt; surfaceNormal;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        <span class="comment">// Per segment the list of levels of the surfaces</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        <a class="code" href="namespaceFoam.html#a8d042301b1c77516c5bfd527662e4f54">labelListList</a> surfaceLevel;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        surfaces_.findAllIntersections</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        (</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;            <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>,</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;            <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>,</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            minLevel,           <span class="comment">// gap level of surface has to be bigger</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                                <span class="comment">// than min level of neighbouring cells</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;            surfaceMinLevel,</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;            surfaceMaxLevel,</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;            surfaceLocation,</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;            surfaceNormal,</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;            surfaceLevel</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        );</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;        <span class="comment">// Clear out unnecessary data</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <a class="code" href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">start</a>.clear();</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <a class="code" href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a>.clear();</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        minLevel.clear();</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        <span class="comment">//OBJstream str</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        <span class="comment">//(</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        <span class="comment">//    mesh_.time().path()</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <span class="comment">//  / &quot;findAllIntersections_&quot;</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        <span class="comment">//  + mesh_.time().timeName()</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        <span class="comment">//  + &quot;.obj&quot;</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        <span class="comment">//);</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment"></span>        <span class="comment">//OBJstream str2</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="comment">//(</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        <span class="comment">//    mesh_.time().path()</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        <span class="comment">//  / &quot;findAllIntersections2_&quot;</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        <span class="comment">//  + mesh_.time().timeName()</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;        <span class="comment">//  + &quot;.obj&quot;</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        <span class="comment">//);</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(testFaces, i)</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        {</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = testFaces[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; fLevels = surfaceLevel[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; fPoints = surfaceLocation[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">vectorList</a>&amp; fNormals = surfaceNormal[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>];</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;            <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(fLevels, hitI)</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;            {</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                checkProximity</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                (</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                    planarCos,</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                    nAllowRefine,</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                    fLevels[hitI],</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                    fPoints[hitI],</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                    fNormals[hitI],</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                    own,</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                    cellMaxLevel[own],</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                    cellMaxLocation[own],</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;                    cellMaxNormal[own],</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                    refineCell,</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                    nRefine</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                );</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;            }</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;            <span class="keywordflow">if</span> (mesh_.isInternalFace(faceI))</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;            {</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nei = mesh_.faceNeighbour()[faceI];</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(fLevels, hitI)</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                {</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                    checkProximity</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                    (</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                        planarCos,</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;                        nAllowRefine,</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                        fLevels[hitI],</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                        fPoints[hitI],</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                        fNormals[hitI],</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                        nei,</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                        cellMaxLevel[nei],</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                        cellMaxLocation[nei],</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                        cellMaxNormal[nei],</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                        refineCell,</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                        nRefine</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                    );</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                }</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            }</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        }</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    }</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="comment">// 2. Find out a measure of surface curvature and region edges.</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="comment">// Send over surface region and surface normal to neighbour cell.</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> neiBndMaxLevel(mesh_.nBoundaryFaces());</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a> neiBndMaxLocation(mesh_.nBoundaryFaces());</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <a class="code" href="namespaceFoam.html#aa6a94734c26b4f5d0008931862eddcd8">vectorField</a> neiBndMaxNormal(mesh_.nBoundaryFaces());</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = mesh_.nInternalFaces(); faceI &lt; mesh_.nFaces(); faceI++)</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    {</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> bFaceI = faceI-mesh_.nInternalFaces();</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        neiBndMaxLevel[bFaceI] = cellMaxLevel[own];</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        neiBndMaxLocation[bFaceI] = cellMaxLocation[own];</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        neiBndMaxNormal[bFaceI] = cellMaxNormal[own];</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    }</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <a class="code" href="classFoam_1_1syncTools.html#ab59012dece791b34a5780b0771f8c9b5">syncTools::swapBoundaryFaceList</a>(mesh_, neiBndMaxLevel);</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <a class="code" href="classFoam_1_1syncTools.html#ab59012dece791b34a5780b0771f8c9b5">syncTools::swapBoundaryFaceList</a>(mesh_, neiBndMaxLocation);</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    <a class="code" href="classFoam_1_1syncTools.html#ab59012dece791b34a5780b0771f8c9b5">syncTools::swapBoundaryFaceList</a>(mesh_, neiBndMaxNormal);</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <span class="comment">// Loop over all faces. Could only be checkFaces.. except if they&#39;re coupled</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <span class="comment">// Internal faces</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = 0; faceI &lt; mesh_.nInternalFaces(); faceI++)</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    {</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nei = mesh_.faceNeighbour()[faceI];</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <span class="keywordflow">if</span> (cellMaxLevel[own] != -1 &amp;&amp; cellMaxLevel[nei] != -1)</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        {</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;            <span class="comment">// Have valid data on both sides. Check planarCos.</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;            <span class="keywordflow">if</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;            (</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                isNormalGap</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                (</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                    planarCos,</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                    cellLevel[own], <span class="comment">//cellMaxLevel[own],</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                    cellMaxLocation[own],</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                    cellMaxNormal[own],</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                    cellLevel[nei], <span class="comment">//cellMaxLevel[nei],</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                    cellMaxLocation[nei],</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                    cellMaxNormal[nei]</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                )</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;            )</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;            {</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                <span class="comment">// See which side to refine</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                <span class="keywordflow">if</span> (cellLevel[own] &lt; cellMaxLevel[own])</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                {</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                    <span class="keywordflow">if</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                    (</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                        !markForRefine</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                        (</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                            cellMaxLevel[own],</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                            nAllowRefine,</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                            refineCell[own],</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                            nRefine</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;                        )</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                    )</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                    {</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                        {</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                            <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining since reaching my cell&quot;</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot; limit of &quot;</span> &lt;&lt; mesh_.nCells()+7*nRefine</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                                &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                        }</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                    }</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                }</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                <span class="keywordflow">if</span> (cellLevel[nei] &lt; cellMaxLevel[nei])</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                {</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                    <span class="keywordflow">if</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                    (</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                        !markForRefine</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                        (</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;                            cellMaxLevel[nei],</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                            nAllowRefine,</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                            refineCell[nei],</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                            nRefine</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                        )</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                    )</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                    {</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                        {</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                            <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining since reaching my cell&quot;</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot; limit of &quot;</span> &lt;&lt; mesh_.nCells()+7*nRefine</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                                &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                        }</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                    }</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                }</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;            }</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        }</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    }</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="comment">// Boundary faces</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = mesh_.nInternalFaces(); faceI &lt; mesh_.nFaces(); faceI++)</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    {</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> own = mesh_.faceOwner()[faceI];</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> bFaceI = faceI - mesh_.nInternalFaces();</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <span class="keywordflow">if</span> (cellLevel[own] &lt; cellMaxLevel[own] &amp;&amp; neiBndMaxLevel[bFaceI] != -1)</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        {</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;            <span class="comment">// Have valid data on both sides. Check planarCos.</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;            <span class="keywordflow">if</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;            (</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                isNormalGap</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                (</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                    planarCos,</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                    cellLevel[own], <span class="comment">//cellMaxLevel[own],</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                    cellMaxLocation[own],</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                    cellMaxNormal[own],</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                    neiLevel[bFaceI], <span class="comment">//neiBndMaxLevel[bFaceI],</span></div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                    neiBndMaxLocation[bFaceI],</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                    neiBndMaxNormal[bFaceI]</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                )</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;            )</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;            {</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                <span class="keywordflow">if</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                (</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;                    !markForRefine</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                    (</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                        cellMaxLevel[own],</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;                        nAllowRefine,</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                        refineCell[own],</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                        nRefine</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                    )</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                )</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                {</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                    {</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining since reaching my cell&quot;</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot; limit of &quot;</span> &lt;&lt; mesh_.nCells()+7*nRefine</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                            &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                    }</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                }</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;            }</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        }</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    }</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <span class="keywordflow">if</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    (</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      &gt; <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nAllowRefine, sumOp&lt;label&gt;())</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    )</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    {</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Reached refinement limit.&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    }</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nRefine-oldNRefine, sumOp&lt;label&gt;());</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;}</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">// * * * * * * * * * * * * * * * Member Functions  * * * * * * * * * * * * * //</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment">// Calculate list of cells to refine. Gets for any edge (start - end)</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">// whether it intersects the surface. Does more accurate test and checks</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment">// the wanted level on the surface intersected.</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">// Does approximate precalculation of how many cells can be refined before</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">// hitting overall limit maxGlobalCells.</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<a class="code" href="classFoam_1_1List.html">Foam::labelList</a> <a class="code" href="classFoam_1_1meshRefinement.html#a7542c70fe09fdad6d37c733d83a4d96d">Foam::meshRefinement::refineCandidates</a></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;(</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; keepPoints,</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    <span class="keyword">const</span> scalar curvature,</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="keyword">const</span> scalar planarAngle,</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> featureRefinement,</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> featureDistanceRefinement,</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> internalRefinement,</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> surfaceRefinement,</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> curvatureRefinement,</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> smallFeatureRefinement,</div>
<div class="line"><a name="l02043"></a><span class="lineno"><a class="line" href="classFoam_1_1meshRefinement.html#a7542c70fe09fdad6d37c733d83a4d96d"> 2043</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> gapRefinement,</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> bigGapRefinement,</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> spreadGapSize,</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> maxGlobalCells,</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> maxLocalCells</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> totNCells = mesh_.globalData().nTotalCells();</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <a class="code" href="classFoam_1_1List.html">labelList</a> cellsToRefine;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="keywordflow">if</span> (totNCells &gt;= maxGlobalCells)</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    {</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;        <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;No cells marked for refinement since reached limit &quot;</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;            &lt;&lt; maxGlobalCells &lt;&lt; <span class="charliteral">&#39;.&#39;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    }</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    {</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        <span class="comment">// Every cell I refine adds 7 cells. Estimate the number of cells</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;        <span class="comment">// I am allowed to refine.</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="comment">// Assume perfect distribution so can only refine as much the fraction</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <span class="comment">// of the mesh I hold. This prediction step prevents us having to do</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        <span class="comment">// lots of reduces to keep count of the total number of cells selected</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        <span class="comment">// for refinement.</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        <span class="comment">//scalar fraction = scalar(mesh_.nCells())/totNCells;</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;        <span class="comment">//label myMaxCells = label(maxGlobalCells*fraction);</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;        <span class="comment">//label nAllowRefine = (myMaxCells - mesh_.nCells())/7;</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment"></span>        <span class="comment">//</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        <span class="comment">//Pout&lt;&lt; &quot;refineCandidates:&quot; &lt;&lt; nl</span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        <span class="comment">//    &lt;&lt; &quot;    total cells:&quot; &lt;&lt; totNCells &lt;&lt; nl</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        <span class="comment">//    &lt;&lt; &quot;    local cells:&quot; &lt;&lt; mesh_.nCells() &lt;&lt; nl</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        <span class="comment">//    &lt;&lt; &quot;    local fraction:&quot; &lt;&lt; fraction &lt;&lt; nl</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        <span class="comment">//    &lt;&lt; &quot;    local allowable cells:&quot; &lt;&lt; myMaxCells &lt;&lt; nl</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;        <span class="comment">//    &lt;&lt; &quot;    local allowable refinement:&quot; &lt;&lt; nAllowRefine &lt;&lt; nl</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        <span class="comment">//    &lt;&lt; endl;</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;        <span class="comment">//- Disable refinement shortcut. nAllowRefine is per processor limit.</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine = <a class="code" href="namespaceFoam.html#a700fe3bfa3b7c2f5937307d76372ab4e">labelMax</a> / <a class="code" href="classFoam_1_1UPstream.html#aada0e04d8127eda8ee95be0772754a4f">Pstream::nProcs</a>();</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        <span class="comment">// Marked for refinement (&gt;= 0) or not (-1). Actual value is the</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        <span class="comment">// index of the surface it intersects / shell it is inside.</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        <a class="code" href="classFoam_1_1List.html">labelList</a> refineCell(mesh_.nCells(), -1);</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nRefine = 0;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        <span class="comment">// Swap neighbouring cell centres and cell level</span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        <a class="code" href="classFoam_1_1List.html">labelList</a> neiLevel(mesh_.nFaces()-mesh_.nInternalFaces());</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        <a class="code" href="classFoam_1_1Field.html">pointField</a> neiCc(mesh_.nFaces()-mesh_.nInternalFaces());</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        calcNeighbourData(neiLevel, neiCc);</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;        <span class="keyword">const</span> scalar planarCos = <a class="code" href="namespaceFoam.html#aebb41a148f7cf44b63e12f69e487e49f">Foam::cos</a>(<a class="code" href="namespaceFoam.html#a29bdf29209233267101e6fc9463dabf1">degToRad</a>(planarAngle));</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="comment">// Cells pierced by feature lines</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <span class="keywordflow">if</span> (featureRefinement)</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        {</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nFeatures = markFeatureRefinement</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;            (</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                keepPoints,</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                nAllowRefine,</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                refineCell,</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                nRefine</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;            );</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Marked for refinement due to explicit features             &quot;</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; nFeatures &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        }</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;        <span class="comment">// Inside distance-to-feature shells</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;        <span class="keywordflow">if</span> (featureDistanceRefinement)</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        {</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nShell = markInternalDistanceToFeatureRefinement</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;            (</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;                nAllowRefine,</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                refineCell,</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                nRefine</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;            );</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Marked for refinement due to distance to explicit features &quot;</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; nShell &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        }</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        <span class="comment">// Inside refinement shells</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <span class="keywordflow">if</span> (internalRefinement)</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        {</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nShell = markInternalRefinement</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;            (</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                nAllowRefine,</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                refineCell,</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                nRefine</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;            );</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Marked for refinement due to refinement shells             &quot;</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; nShell &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        }</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        <span class="comment">// Refinement based on intersection of surface</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;        <span class="keywordflow">if</span> (surfaceRefinement)</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;        {</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nSurf = markSurfaceRefinement</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;            (</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                nAllowRefine,</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                neiLevel,</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                neiCc,</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;                refineCell,</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                nRefine</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;            );</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Marked for refinement due to surface intersection          &quot;</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; nSurf &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;            <span class="comment">// Refine intersected-cells only inside gaps. See</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;            <span class="comment">// markInternalGapRefinement to refine all cells inside gaps.</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;            <span class="keywordflow">if</span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;            (</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                planarCos &gt;= -1</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;             &amp;&amp; planarCos &lt;= 1</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;             &amp;&amp; <a class="code" href="namespaceFoam.html#a0e0c00c14acbabe88eec56a8b0fa2806">max</a>(shells_.maxGapLevel()) &gt; 0</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;            )</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;            {</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nGapSurf = markSurfaceGapRefinement</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                (</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                    planarCos,</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                    nAllowRefine,</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                    neiLevel,</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                    neiCc,</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                    refineCell,</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                    nRefine</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                );</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Marked for refinement due to surface intersection&quot;</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; (at gaps)&quot;</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; nGapSurf &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;            }</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;        }</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        <span class="comment">// Refinement based on curvature of surface</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        <span class="keywordflow">if</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        (</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;            curvatureRefinement</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;         &amp;&amp; (curvature &gt;= -1 &amp;&amp; curvature &lt;= 1)</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;         &amp;&amp; (surfaces_.minLevel() != surfaces_.maxLevel())</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        )</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;        {</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nCurv = markSurfaceCurvatureRefinement</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;            (</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                curvature,</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                nAllowRefine,</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                neiLevel,</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                neiCc,</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                refineCell,</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                nRefine</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;            );</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Marked for refinement due to curvature/regions             &quot;</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; nCurv &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        }</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="comment">// Refinement based on features smaller than cell size</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        <span class="keywordflow">if</span></div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;        (</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;            smallFeatureRefinement</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;         &amp;&amp; (planarCos &gt;= -1 &amp;&amp; planarCos &lt;= 1)</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;         &amp;&amp; <a class="code" href="namespaceFoam.html#a0e0c00c14acbabe88eec56a8b0fa2806">max</a>(shells_.maxGapLevel()) &gt; 0</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;        )</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        {</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nGap = markSmallFeatureRefinement</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;            (</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                planarCos,</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                nAllowRefine,</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                neiLevel,</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                neiCc,</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                refineCell,</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                nRefine</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;            );</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Marked for refinement due to close opposite surfaces       &quot;</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; nGap &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;        }</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="comment">// Refinement based on gap (only neighbouring cells)</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        <span class="keyword">const</span> <a class="code" href="classFoam_1_1List.html">labelList</a>&amp; surfaceGapLevel = surfaces_.gapLevel();</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;        <span class="keywordflow">if</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        (</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;            gapRefinement</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;         &amp;&amp; (planarCos &gt;= -1 &amp;&amp; planarCos &lt;= 1)</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;         &amp;&amp; (<a class="code" href="namespaceFoam.html#a0e0c00c14acbabe88eec56a8b0fa2806">max</a>(surfaceGapLevel) &gt; -1)</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        )</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;        {</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Specified gap level : &quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a0e0c00c14acbabe88eec56a8b0fa2806">max</a>(surfaceGapLevel)</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, planar angle &quot;</span> &lt;&lt; planarAngle &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nGap = markProximityRefinement</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;            (</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                planarCos,</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>(surfaceGapLevel.<a class="code" href="classFoam_1_1UList.html#afee03bfededf699921815b2bf3c41e35">size</a>(), -1),  <span class="comment">// surface min level</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                surfaceGapLevel,                        <span class="comment">// surface max level</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                nAllowRefine,</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                neiLevel,</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                neiCc,</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                refineCell,</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                nRefine</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;            );</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Marked for refinement due to close opposite surfaces       &quot;</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; nGap &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;        }</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        <span class="comment">// Refinement based on gaps larger than cell size</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;        <span class="keywordflow">if</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        (</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;            bigGapRefinement</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;         &amp;&amp; (planarCos &gt;= -1 &amp;&amp; planarCos &lt;= 1)</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;         &amp;&amp; <a class="code" href="namespaceFoam.html#a0e0c00c14acbabe88eec56a8b0fa2806">max</a>(shells_.maxGapLevel()) &gt; 0</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        )</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;        {</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;            <span class="comment">// Refine based on gap information provided by shell and nearest</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;            <span class="comment">// surface</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;            <a class="code" href="classFoam_1_1List.html">labelList</a> numGapCells;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;            <a class="code" href="classFoam_1_1Field.html">scalarField</a> gapSize;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nGap = markInternalGapRefinement</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;            (</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;                planarCos,</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;                spreadGapSize,</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                nAllowRefine,</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                refineCell,</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                nRefine,</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                numGapCells,</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                gapSize</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;            );</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Marked for refinement due to opposite surfaces&quot;</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;             &quot;</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; nGap &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        }</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;        <span class="comment">// Limit refinement</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        {</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nUnmarked = unmarkInternalRefinement(refineCell, nRefine);</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;            <span class="keywordflow">if</span> (nUnmarked &gt; 0)</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            {</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Unmarked for refinement due to limit shells&quot;</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;                : &quot;</span> &lt;&lt; nUnmarked &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;            }</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        }</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        <span class="comment">// Pack cells-to-refine</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        cellsToRefine.<a class="code" href="classFoam_1_1List.html#a3eb74b6b9f8c1346a09c49e3eade797c">setSize</a>(nRefine);</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        nRefine = 0;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(refineCell, cellI)</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        {</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;            <span class="keywordflow">if</span> (refineCell[cellI] != -1)</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;            {</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                cellsToRefine[nRefine++] = cellI;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;            }</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        }</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    }</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <span class="keywordflow">return</span> cellsToRefine;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;}</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<a class="code" href="classFoam_1_1autoPtr.html">Foam::autoPtr&lt;Foam::mapPolyMesh&gt;</a> <a class="code" href="classFoam_1_1meshRefinement.html#ac9571690bc552fe5150042c81c4f8229">Foam::meshRefinement::refine</a></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;(</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <span class="keyword">const</span> <a class="code" href="classFoam_1_1List.html">labelList</a>&amp; cellsToRefine</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;)</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;{</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <span class="comment">// Mesh changing engine.</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <a class="code" href="classFoam_1_1polyTopoChange.html">polyTopoChange</a> meshMod(mesh_);</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="comment">// Play refinement commands into mesh changer.</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    meshCutter_.setRefinement(cellsToRefine, meshMod);</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <span class="comment">// Create mesh (no inflation), return map from old to new mesh.</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    <a class="code" href="classFoam_1_1autoPtr.html">autoPtr&lt;mapPolyMesh&gt;</a> mapPtr = meshMod.changeMesh(mesh_, <span class="keyword">false</span>);</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <a class="code" href="classFoam_1_1mapPolyMesh.html">mapPolyMesh</a>&amp; map = *mapPtr;</div>
<div class="line"><a name="l02353"></a><span class="lineno"><a class="line" href="classFoam_1_1meshRefinement.html#ac9571690bc552fe5150042c81c4f8229"> 2353</a></span>&#160;</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <span class="comment">// Update fields</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    mesh_.updateMesh(map);</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    <span class="comment">// Optionally inflate mesh</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <span class="keywordflow">if</span> (map.<a class="code" href="classFoam_1_1mapPolyMesh.html#a7e7aae2a61b34b47a470ad7821c4597a">hasMotionPoints</a>())</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    {</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        mesh_.movePoints(map.<a class="code" href="classFoam_1_1mapPolyMesh.html#a2e8e4273c887a677b7822169559781ef">preMotionPoints</a>());</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    }</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    {</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;        <span class="comment">// Delete mesh volumes.</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;        mesh_.clearOut();</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    }</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="comment">// Reset the instance for if in overwrite mode</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    mesh_.setInstance(<a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>());</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <span class="comment">// Update intersection info</span></div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    updateMesh(map, getChangedFaces(map, cellsToRefine));</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="keywordflow">return</span> mapPtr;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;}</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment">// Do refinement of consistent set of cells followed by truncation and</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">// load balancing.</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<a class="code" href="classFoam_1_1autoPtr.html">Foam::autoPtr&lt;Foam::mapDistributePolyMesh&gt;</a></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<a class="code" href="classFoam_1_1meshRefinement.html#ac205e187b0cac287f346f71f7f170f00">Foam::meshRefinement::refineAndBalance</a></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;(</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; msg,</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    decompositionMethod&amp; decomposer,</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    fvMeshDistribute&amp; distributor,</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellsToRefine,</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="keyword">const</span> scalar maxLoadUnbalance</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;)</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;{</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;    <span class="comment">// Do all refinement</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    refine(cellsToRefine);</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;<a class="code" href="classFoam_1_1meshRefinement.html#a92dc814ea7fd34acae287945426740d3a0b8403fccaa9b51239c179649c6fcb50">meshRefinement::MESH</a>)</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    {</div>
<div class="line"><a name="l02395"></a><span class="lineno"><a class="line" href="classFoam_1_1meshRefinement.html#ac205e187b0cac287f346f71f7f170f00"> 2395</a></span>&#160;        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Writing refined but unbalanced &quot;</span> &lt;&lt; msg</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; mesh to time &quot;</span> &lt;&lt; <a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>() &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;        <a class="code" href="namespaceFoam_1_1vtk.html#a5ddab0eba69f47ec148a4a5f9d8f334a">write</a></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;        (</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;            <a class="code" href="classFoam_1_1meshRefinement.html#a92dc814ea7fd34acae287945426740d3">debugType</a>(<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>),</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;            <a class="code" href="classFoam_1_1meshRefinement.html#a4376f23cd92e9a8416762b079ce7a0c9">writeType</a>(writeLevel() | WRITEMESH),</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;            mesh_.time().path()/<a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>()</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;        );</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Dumped debug data in = &quot;</span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;            &lt;&lt; mesh_.time().cpuTimeIncrement() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        <span class="comment">// test all is still synced across proc patches</span></div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        <a class="code" href="namespaceFoam.html#ac7ee3b57a297e452e16d8ae61ceba1d4">checkData</a>();</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;    }</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;    <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Refined mesh in = &quot;</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        &lt;&lt; mesh_.time().cpuTimeIncrement() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    printMeshInfo(<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>, <span class="stringliteral">&quot;After refinement &quot;</span> + msg);</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;    <span class="comment">// Load balancing</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;    <a class="code" href="classFoam_1_1autoPtr.html">autoPtr&lt;mapDistributePolyMesh&gt;</a> distMap;</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classFoam_1_1UPstream.html#aada0e04d8127eda8ee95be0772754a4f">Pstream::nProcs</a>() &gt; 1)</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    {</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        scalar nIdealCells =</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;            mesh_.globalData().nTotalCells()</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;          / <a class="code" href="classFoam_1_1UPstream.html#aada0e04d8127eda8ee95be0772754a4f">Pstream::nProcs</a>();</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        scalar unbalance = <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        (</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;            <a class="code" href="namespaceFoam.html#a834bb6faa2fd38f3b65634f2e1987e97">mag</a>(1.0-mesh_.nCells()/nIdealCells),</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;            <a class="code" href="structFoam_1_1maxOp.html">maxOp&lt;scalar&gt;</a>()</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;        );</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        <span class="keywordflow">if</span> (unbalance &lt;= maxLoadUnbalance)</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;        {</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Skipping balancing since max unbalance &quot;</span> &lt;&lt; unbalance</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; is less than allowable &quot;</span> &lt;&lt; maxLoadUnbalance</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        }</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;        {</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;            <a class="code" href="namespaceFoam.html#a6e363d070e971ead1a4c40475084e584">scalarField</a> cellWeights(mesh_.nCells(), 1);</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;            distMap = balance</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;            (</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                <span class="keyword">false</span>,  <span class="comment">//keepZoneFaces</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                <span class="keyword">false</span>,  <span class="comment">//keepBaffles</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                cellWeights,</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                decomposer,</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                distributor</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;            );</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Balanced mesh in = &quot;</span></div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                &lt;&lt; mesh_.time().cpuTimeIncrement() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;            printMeshInfo(<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>, <span class="stringliteral">&quot;After balancing &quot;</span> + msg);</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;meshRefinement::MESH)</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;            {</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Writing balanced &quot;</span> &lt;&lt; msg</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; mesh to time &quot;</span> &lt;&lt; <a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>() &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                <a class="code" href="namespaceFoam_1_1vtk.html#a5ddab0eba69f47ec148a4a5f9d8f334a">write</a></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                (</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                    debugType(<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>),</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                    writeType(writeLevel() | WRITEMESH),</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                    mesh_.time().path()/<a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>()</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;                );</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Dumped debug data in = &quot;</span></div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                    &lt;&lt; mesh_.time().cpuTimeIncrement() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                <span class="comment">// test all is still synced across proc patches</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                <a class="code" href="namespaceFoam.html#ac7ee3b57a297e452e16d8ae61ceba1d4">checkData</a>();</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;            }</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;        }</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    }</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    <span class="keywordflow">return</span> distMap;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;}</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;<span class="comment">// Do load balancing followed by refinement of consistent set of cells.</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<a class="code" href="classFoam_1_1autoPtr.html">Foam::autoPtr&lt;Foam::mapDistributePolyMesh&gt;</a></div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<a class="code" href="classFoam_1_1meshRefinement.html#a02af88fa15d03fdfdc48254ccdd2a45c">Foam::meshRefinement::balanceAndRefine</a></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;(</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; msg,</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    decompositionMethod&amp; decomposer,</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;    fvMeshDistribute&amp; distributor,</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; initCellsToRefine,</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <span class="keyword">const</span> scalar maxLoadUnbalance</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;)</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;{</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> cellsToRefine(initCellsToRefine);</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;    <span class="comment">//    globalIndex globalCells(mesh_.nCells());</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02496"></a><span class="lineno"><a class="line" href="classFoam_1_1meshRefinement.html#a02af88fa15d03fdfdc48254ccdd2a45c"> 2496</a></span>&#160;    <span class="comment">//    Info&lt;&lt; &quot;** Distribution before balancing/refining:&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    <span class="comment">//    for (label procI = 0; procI &lt; Pstream::nProcs(); procI++)</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    <span class="comment">//    {</span></div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <span class="comment">//        Info&lt;&lt; &quot;    &quot; &lt;&lt; procI &lt;&lt; &#39;\t&#39;</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    <span class="comment">//            &lt;&lt; globalCells.localSize(procI) &lt;&lt; endl;</span></div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;    <span class="comment">//    }</span></div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="comment">//    Info&lt;&lt; endl;</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;    <span class="comment">//    globalIndex globalCells(cellsToRefine.size());</span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    <span class="comment">//    Info&lt;&lt; &quot;** Cells to be refined:&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    <span class="comment">//    for (label procI = 0; procI &lt; Pstream::nProcs(); procI++)</span></div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    <span class="comment">//    {</span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;    <span class="comment">//        Info&lt;&lt; &quot;    &quot; &lt;&lt; procI &lt;&lt; &#39;\t&#39;</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;    <span class="comment">//            &lt;&lt; globalCells.localSize(procI) &lt;&lt; endl;</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;    <span class="comment">//    }</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;    <span class="comment">//    Info&lt;&lt; endl;</span></div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    <span class="comment">// Load balancing</span></div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    <a class="code" href="classFoam_1_1autoPtr.html">autoPtr&lt;mapDistributePolyMesh&gt;</a> distMap;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classFoam_1_1UPstream.html#aada0e04d8127eda8ee95be0772754a4f">Pstream::nProcs</a>() &gt; 1)</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    {</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        <span class="comment">// First check if we need to balance at all. Precalculate number of</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        <span class="comment">// cells after refinement and see what maximum difference is.</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;        scalar nNewCells = scalar(mesh_.nCells() + 7*cellsToRefine.size());</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        scalar nIdealNewCells =</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;            <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nNewCells, <a class="code" href="structFoam_1_1sumOp.html">sumOp&lt;scalar&gt;</a>())</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;          / <a class="code" href="classFoam_1_1UPstream.html#aada0e04d8127eda8ee95be0772754a4f">Pstream::nProcs</a>();</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        scalar unbalance = <a class="code" href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        (</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;            <a class="code" href="namespaceFoam.html#a834bb6faa2fd38f3b65634f2e1987e97">mag</a>(1.0-nNewCells/nIdealNewCells),</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;            <a class="code" href="structFoam_1_1maxOp.html">maxOp&lt;scalar&gt;</a>()</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        );</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        <span class="keywordflow">if</span> (unbalance &lt;= maxLoadUnbalance)</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        {</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Skipping balancing since max unbalance &quot;</span> &lt;&lt; unbalance</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; is less than allowable &quot;</span> &lt;&lt; maxLoadUnbalance</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        }</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        {</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;            <a class="code" href="classFoam_1_1Field.html">scalarField</a> cellWeights(mesh_.nCells(), 1);</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;            <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(cellsToRefine, i)</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;            {</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                cellWeights[cellsToRefine[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>]] += 7;</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;            }</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;            distMap = balance</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;            (</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                <span class="keyword">false</span>,  <span class="comment">//keepZoneFaces</span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;                <span class="keyword">false</span>,  <span class="comment">//keepBaffles</span></div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;                cellWeights,</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;                decomposer,</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;                distributor</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;            );</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;            <span class="comment">// Update cells to refine</span></div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;            distMap().distributeCellIndices(cellsToRefine);</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;            <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Balanced mesh in = &quot;</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;                &lt;&lt; mesh_.time().cpuTimeIncrement() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;        }</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        <span class="comment">//{</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;        <span class="comment">//    globalIndex globalCells(mesh_.nCells());</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;        <span class="comment">//    Info&lt;&lt; &quot;** Distribution after balancing:&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;        <span class="comment">//    for (label procI = 0; procI &lt; Pstream::nProcs(); procI++)</span></div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        <span class="comment">//    {</span></div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        <span class="comment">//        Info&lt;&lt; &quot;    &quot; &lt;&lt; procI &lt;&lt; &#39;\t&#39;</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;        <span class="comment">//            &lt;&lt; globalCells.localSize(procI) &lt;&lt; endl;</span></div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;        <span class="comment">//    }</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;        <span class="comment">//    Info&lt;&lt; endl;</span></div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;        <span class="comment">//}</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;        printMeshInfo(<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>, <span class="stringliteral">&quot;After balancing &quot;</span> + msg);</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;meshRefinement::MESH)</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;        {</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Writing balanced &quot;</span> &lt;&lt; msg</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; mesh to time &quot;</span> &lt;&lt; <a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>() &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;            <a class="code" href="namespaceFoam_1_1vtk.html#a5ddab0eba69f47ec148a4a5f9d8f334a">write</a></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            (</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                <a class="code" href="classFoam_1_1meshRefinement.html#a92dc814ea7fd34acae287945426740d3">debugType</a>(<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>),</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                <a class="code" href="classFoam_1_1meshRefinement.html#a4376f23cd92e9a8416762b079ce7a0c9">writeType</a>(writeLevel() | WRITEMESH),</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                mesh_.time().path()/<a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>()</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;            );</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;            <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Dumped debug data in = &quot;</span></div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                &lt;&lt; mesh_.time().cpuTimeIncrement() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;            <span class="comment">// test all is still synced across proc patches</span></div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;            <a class="code" href="namespaceFoam.html#ac7ee3b57a297e452e16d8ae61ceba1d4">checkData</a>();</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;        }</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;    }</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    <span class="comment">// Refinement</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;    <span class="comment">// ~~~~~~~~~~</span></div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;    refine(cellsToRefine);</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>&amp;meshRefinement::MESH)</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    {</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Writing refined &quot;</span> &lt;&lt; msg</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; mesh to time &quot;</span> &lt;&lt; <a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>() &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;        <a class="code" href="namespaceFoam_1_1vtk.html#a5ddab0eba69f47ec148a4a5f9d8f334a">write</a></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;        (</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;            debugType(<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>),</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;            writeType(writeLevel() | WRITEMESH),</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;            mesh_.time().path()/<a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>()</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;        );</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Dumped debug data in = &quot;</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;            &lt;&lt; mesh_.time().cpuTimeIncrement() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;        <span class="comment">// test all is still synced across proc patches</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        <a class="code" href="namespaceFoam.html#ac7ee3b57a297e452e16d8ae61ceba1d4">checkData</a>();</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    }</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;    <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Refined mesh in = &quot;</span></div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;        &lt;&lt; mesh_.time().cpuTimeIncrement() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    <span class="comment">//    globalIndex globalCells(mesh_.nCells());</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <span class="comment">//    Info&lt;&lt; &quot;** After refinement distribution:&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    <span class="comment">//    for (label procI = 0; procI &lt; Pstream::nProcs(); procI++)</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;    <span class="comment">//    {</span></div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    <span class="comment">//        Info&lt;&lt; &quot;    &quot; &lt;&lt; procI &lt;&lt; &#39;\t&#39;</span></div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;    <span class="comment">//            &lt;&lt; globalCells.localSize(procI) &lt;&lt; endl;</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    <span class="comment">//    }</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;    <span class="comment">//    Info&lt;&lt; endl;</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    printMeshInfo(<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>, <span class="stringliteral">&quot;After refinement &quot;</span> + msg);</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    <span class="keywordflow">return</span> distMap;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;}</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<a class="code" href="classFoam_1_1List.html">Foam::labelList</a> <a class="code" href="classFoam_1_1meshRefinement.html#a17de2ab00585c887fc4fc7154fc85fcd">Foam::meshRefinement::directionalRefineCandidates</a></div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;(</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> maxGlobalCells,</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> maxLocalCells,</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; currentLevel,</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#aa6dfcfe3ecf99188a153595df16285bb">direction</a> dir</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;)<span class="keyword"> const</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellLevel = meshCutter_.cellLevel();</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>&amp; cellCentres = mesh_.cellCentres();</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> totNCells = mesh_.globalData().nTotalCells();</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a> cellsToRefine;</div>
<div class="line"><a name="l02656"></a><span class="lineno"><a class="line" href="classFoam_1_1meshRefinement.html#a17de2ab00585c887fc4fc7154fc85fcd"> 2656</a></span>&#160;</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    <span class="keywordflow">if</span> (totNCells &gt;= maxGlobalCells)</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    {</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;No cells marked for refinement since reached limit &quot;</span></div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;            &lt;&lt; maxGlobalCells &lt;&lt; <span class="charliteral">&#39;.&#39;</span> &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    }</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    {</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;        <span class="comment">// Disable refinement shortcut. nAllowRefine is per processor limit.</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nAllowRefine = <a class="code" href="namespaceFoam.html#a700fe3bfa3b7c2f5937307d76372ab4e">labelMax</a> / <a class="code" href="classFoam_1_1UPstream.html#aada0e04d8127eda8ee95be0772754a4f">Pstream::nProcs</a>();</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;        <span class="comment">// Marked for refinement (&gt;= 0) or not (-1). Actual value is the</span></div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;        <span class="comment">// index of the surface it intersects / shell it is inside</span></div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;        <a class="code" href="classFoam_1_1List.html">labelList</a> refineCell(mesh_.nCells(), -1);</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;        <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nRefine = 0;</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;        <span class="comment">// Find cells inside the shells with directional levels</span></div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;        <a class="code" href="classFoam_1_1List.html">labelList</a> insideShell;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;        shells_.findDirectionalLevel</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        (</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;            cellCentres,</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;            cellLevel,</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;            currentLevel,  <span class="comment">// current directional level</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;            dir,</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;            insideShell</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        );</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        <span class="comment">// Mark for refinement</span></div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(insideShell, celli)</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;        {</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;            <span class="keywordflow">if</span> (insideShell[celli] &gt;= 0)</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;            {</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                <span class="keywordtype">bool</span> reachedLimit = !markForRefine</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;                (</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;                    insideShell[celli],    <span class="comment">// mark with any positive value</span></div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;                    nAllowRefine,</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;                    refineCell[celli],</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                    nRefine</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                );</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;                <span class="keywordflow">if</span> (reachedLimit)</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;                {</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;                    {</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                        <a class="code" href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Pout</a>&lt;&lt; <span class="stringliteral">&quot;Stopped refining cells&quot;</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot; since reaching my cell limit of &quot;</span></div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;                            &lt;&lt; mesh_.nCells()+nAllowRefine &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;                    }</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;                }</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;            }</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;        }</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;        <span class="comment">// Limit refinement</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;        {</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;            <a class="code" href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nUnmarked = unmarkInternalRefinement(refineCell, nRefine);</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;            <span class="keywordflow">if</span> (nUnmarked &gt; 0)</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;            {</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;                <a class="code" href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Unmarked for refinement due to limit shells&quot;</span></div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;                : &quot;</span> &lt;&lt; nUnmarked &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span>  &lt;&lt; <a class="code" href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;            }</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;        }</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;        <span class="comment">// Pack cells-to-refine</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        cellsToRefine.setSize(nRefine);</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;        nRefine = 0;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;        <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(refineCell, cellI)</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        {</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;            <span class="keywordflow">if</span> (refineCell[cellI] != -1)</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;            {</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;                cellsToRefine[nRefine++] = cellI;</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;            }</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;        }</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    }</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;    <span class="keywordflow">return</span> cellsToRefine;</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;}</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;<a class="code" href="classFoam_1_1autoPtr.html">Foam::autoPtr&lt;Foam::mapPolyMesh&gt;</a> <a class="code" href="classFoam_1_1meshRefinement.html#ac48500d1baf48dc03568d8fe5d7eddbb">Foam::meshRefinement::directionalRefine</a></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;(</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; msg,</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#aa6dfcfe3ecf99188a153595df16285bb">direction</a> cmpt,</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">labelList</a>&amp; cellsToRefine</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;)</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;{</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    <span class="comment">// Set splitting direction</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;    <a class="code" href="namespaceFoam.html#a7ea82552101f041fad7635b3ed036a84">vector</a> refDir(<a class="code" href="namespaceFoam.html#ab64e5584854aaf645dab58faf8793d20">Zero</a>);</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    refDir[cmpt] = 1;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    List&lt;refineCell&gt; <a class="code" href="incompressible_2pimpleFoam_2overPimpleDyMFoam_2correctPhi_8H.html#a98851422016028c0bdb57cfcaf8c70a5">refCells</a>(cellsToRefine.size());</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;    <a class="code" href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(cellsToRefine, i)</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    {</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;        <a class="code" href="incompressible_2pimpleFoam_2overPimpleDyMFoam_2correctPhi_8H.html#a98851422016028c0bdb57cfcaf8c70a5">refCells</a>[<a class="code" href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>] = refineCell(cellsToRefine[i], refDir);</div>
<div class="line"><a name="l02756"></a><span class="lineno"><a class="line" href="classFoam_1_1meshRefinement.html#ac48500d1baf48dc03568d8fe5d7eddbb"> 2756</a></span>&#160;    }</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    <span class="comment">// How to walk circumference of cells</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    <a class="code" href="classFoam_1_1hexCellLooper.html">hexCellLooper</a> cellWalker(mesh_);</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    <span class="comment">// Analyse cuts</span></div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    <a class="code" href="classFoam_1_1cellCuts.html">cellCuts</a> cuts(mesh_, cellWalker, <a class="code" href="incompressible_2pimpleFoam_2overPimpleDyMFoam_2correctPhi_8H.html#a98851422016028c0bdb57cfcaf8c70a5">refCells</a>);</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <span class="comment">// Cell cutter</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;    <a class="code" href="classFoam_1_1meshCutter.html">Foam::meshCutter</a> meshRefiner(mesh_);</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;    <a class="code" href="classFoam_1_1polyTopoChange.html">polyTopoChange</a> meshMod(mesh_);</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    <span class="comment">// Insert mesh refinement into polyTopoChange.</span></div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    meshRefiner.setRefinement(cuts, meshMod);</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    <a class="code" href="classFoam_1_1autoPtr.html">autoPtr&lt;mapPolyMesh&gt;</a> morphMap = meshMod.changeMesh(mesh_, <span class="keyword">false</span>);</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;    <span class="comment">// Update fields</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    mesh_.updateMesh(*morphMap);</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    <span class="comment">// Move mesh (since morphing does not do this)</span></div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <span class="keywordflow">if</span> (morphMap().hasMotionPoints())</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    {</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        mesh_.movePoints(morphMap().preMotionPoints());</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    }</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    {</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;        <span class="comment">// Delete mesh volumes.</span></div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;        mesh_.clearOut();</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;    }</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;    <span class="comment">// Reset the instance for if in overwrite mode</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    mesh_.setInstance(<a class="code" href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a>());</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <span class="comment">// Update stored refinement pattern</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    meshRefiner.updateMesh(*morphMap);</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    <span class="comment">// Update intersection info</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    updateMesh(*morphMap, getChangedFaces(*morphMap, cellsToRefine));</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    <span class="keywordflow">return</span> morphMap;</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;}</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="comment">// ************************************************************************* //</span></div>
<div class="ttc" id="treeDataCell_8H_html"><div class="ttname"><a href="treeDataCell_8H.html">treeDataCell.H</a></div></div>
<div class="ttc" id="classFoam_1_1UList_html_afee03bfededf699921815b2bf3c41e35"><div class="ttname"><a href="classFoam_1_1UList.html#afee03bfededf699921815b2bf3c41e35">Foam::UList::size</a></div><div class="ttdeci">void size(const label n) noexcept</div><div class="ttdoc">Override size to be inconsistent with allocated storage. </div><div class="ttdef"><b>Definition:</b> <a href="UListI_8H_source.html#l00353">UListI.H:353</a></div></div>
<div class="ttc" id="classFoam_1_1regIOobject_html_a1ff0c1446e1074e2d4a6a379857eaa52"><div class="ttname"><a href="classFoam_1_1regIOobject.html#a1ff0c1446e1074e2d4a6a379857eaa52">Foam::regIOobject::write</a></div><div class="ttdeci">virtual bool write(const bool valid=true) const </div><div class="ttdoc">Write using setting from DB. </div><div class="ttdef"><b>Definition:</b> <a href="regIOobjectWrite_8C_source.html#l00167">regIOobjectWrite.C:167</a></div></div>
<div class="ttc" id="namespaceFoam_html_a8d042301b1c77516c5bfd527662e4f54"><div class="ttname"><a href="namespaceFoam.html#a8d042301b1c77516c5bfd527662e4f54">Foam::labelListList</a></div><div class="ttdeci">List&lt; labelList &gt; labelListList</div><div class="ttdoc">A List of labelList. </div><div class="ttdef"><b>Definition:</b> <a href="labelList_8H_source.html#l00051">labelList.H:51</a></div></div>
<div class="ttc" id="heatTransfer_2buoyantPimpleFoam_2overBuoyantPimpleDyMFoam_2correctPhi_8H_html_aa82634858b978d958140338fab813c8b"><div class="ttname"><a href="heatTransfer_2buoyantPimpleFoam_2overBuoyantPimpleDyMFoam_2correctPhi_8H.html#aa82634858b978d958140338fab813c8b">d</a></div><div class="ttdeci">const dictionary &amp; d</div><div class="ttdef"><b>Definition:</b> <a href="heatTransfer_2buoyantPimpleFoam_2overBuoyantPimpleDyMFoam_2correctPhi_8H_source.html#l00077">correctPhi.H:77</a></div></div>
<div class="ttc" id="structFoam_1_1maxOp_html"><div class="ttname"><a href="structFoam_1_1maxOp.html">Foam::maxOp</a></div><div class="ttdef"><b>Definition:</b> <a href="ops_8H_source.html#l00217">ops.H:217</a></div></div>
<div class="ttc" id="namespaceFoam_html_a22f45a3cb4f074e609f58ebaeef0ecf9"><div class="ttname"><a href="namespaceFoam.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a></div><div class="ttdeci">intWM_LABEL_SIZE_t label</div><div class="ttdoc">A label is an int32_t or int64_t as specified by the pre-processor macro WM_LABEL_SIZE. </div><div class="ttdef"><b>Definition:</b> <a href="label_8H_source.html#l00056">label.H:56</a></div></div>
<div class="ttc" id="namespaceFoam_html_aa6dfcfe3ecf99188a153595df16285bb"><div class="ttname"><a href="namespaceFoam.html#aa6dfcfe3ecf99188a153595df16285bb">Foam::direction</a></div><div class="ttdeci">uint8_t direction</div><div class="ttdef"><b>Definition:</b> <a href="direction_8H_source.html#l00041">direction.H:41</a></div></div>
<div class="ttc" id="classFoam_1_1faceSet_html"><div class="ttname"><a href="classFoam_1_1faceSet.html">Foam::faceSet</a></div><div class="ttdoc">A list of face labels. </div><div class="ttdef"><b>Definition:</b> <a href="faceSet_8H_source.html#l00047">faceSet.H:47</a></div></div>
<div class="ttc" id="trackedParticle_8H_html"><div class="ttname"><a href="trackedParticle_8H.html">trackedParticle.H</a></div></div>
<div class="ttc" id="namespaceFoam_1_1expressions_1_1patchExpr_html_ac3e1795766a80ec63b157951b4b9a7d4"><div class="ttname"><a href="namespaceFoam_1_1expressions_1_1patchExpr.html#ac3e1795766a80ec63b157951b4b9a7d4">Foam::expressions::patchExpr::debug</a></div><div class="ttdeci">int debug</div><div class="ttdoc">Static debugging option. </div></div>
<div class="ttc" id="namespaceFoam_html_a834bb6faa2fd38f3b65634f2e1987e97"><div class="ttname"><a href="namespaceFoam.html#a834bb6faa2fd38f3b65634f2e1987e97">Foam::mag</a></div><div class="ttdeci">dimensioned&lt; typename typeOfMag&lt; Type &gt;::type &gt; mag(const dimensioned&lt; Type &gt; &amp;dt)</div></div>
<div class="ttc" id="classFoam_1_1syncTools_html_a1501f504ab48c2a4825518bba5269ab9"><div class="ttname"><a href="classFoam_1_1syncTools.html#a1501f504ab48c2a4825518bba5269ab9">Foam::syncTools::getMasterFaces</a></div><div class="ttdeci">static bitSet getMasterFaces(const polyMesh &amp;mesh)</div><div class="ttdoc">Get per face whether it is uncoupled or a master of a coupled set of faces. </div><div class="ttdef"><b>Definition:</b> <a href="syncTools_8C_source.html#l00119">syncTools.C:119</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a02af88fa15d03fdfdc48254ccdd2a45c"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a02af88fa15d03fdfdc48254ccdd2a45c">Foam::meshRefinement::balanceAndRefine</a></div><div class="ttdeci">autoPtr&lt; mapDistributePolyMesh &gt; balanceAndRefine(const string &amp;msg, decompositionMethod &amp;decomposer, fvMeshDistribute &amp;distributor, const labelList &amp;cellsToRefine, const scalar maxLoadUnbalance)</div><div class="ttdoc">Balance before refining some cells. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l02496">meshRefinementRefine.C:2496</a></div></div>
<div class="ttc" id="Time_8H_html"><div class="ttname"><a href="Time_8H.html">Time.H</a></div></div>
<div class="ttc" id="namespaceFoam_html_af0edf3acab9a043f9653e0ad5908b38f"><div class="ttname"><a href="namespaceFoam.html#af0edf3acab9a043f9653e0ad5908b38f">Foam::sortedOrder</a></div><div class="ttdeci">labelList sortedOrder(const UList&lt; T &gt; &amp;input)</div><div class="ttdoc">Return the (stable) sort order for the list. </div></div>
<div class="ttc" id="namespaceFoam_html_ac7ee3b57a297e452e16d8ae61ceba1d4"><div class="ttname"><a href="namespaceFoam.html#ac7ee3b57a297e452e16d8ae61ceba1d4">Foam::checkData</a></div><div class="ttdeci">label checkData(const fvMesh &amp;mesh, const instantList &amp;timeDirs, wordList &amp;objectNames)</div><div class="ttdoc">Check if fields are good to use (available at all times) </div></div>
<div class="ttc" id="classFoam_1_1List_html"><div class="ttname"><a href="classFoam_1_1List.html">Foam::List&lt; vector &gt;</a></div></div>
<div class="ttc" id="namespaceFoam_html_a0e0c00c14acbabe88eec56a8b0fa2806"><div class="ttname"><a href="namespaceFoam.html#a0e0c00c14acbabe88eec56a8b0fa2806">Foam::max</a></div><div class="ttdeci">label max(const labelHashSet &amp;set, label maxValue=labelMin)</div><div class="ttdoc">Find the max value in labelHashSet, optionally limited by second argument. </div><div class="ttdef"><b>Definition:</b> <a href="hashSets_8C_source.html#l00040">hashSets.C:40</a></div></div>
<div class="ttc" id="classFoam_1_1List_html_a9c583af46074f580ff692170d48899ac"><div class="ttname"><a href="classFoam_1_1List.html#a9c583af46074f580ff692170d48899ac">Foam::List::set</a></div><div class="ttdeci">std::enable_if&lt; std::is_same&lt; bool, TypeT &gt;::value, bool &gt;::type set(const label i, bool val=true)</div><div class="ttdoc">A bitSet::set() method for a list of bool. </div><div class="ttdef"><b>Definition:</b> <a href="List_8H_source.html#l00436">List.H:436</a></div></div>
<div class="ttc" id="shootRays_8H_html_a343b76d5aedb8270ed459bc189e3e407"><div class="ttname"><a href="shootRays_8H.html#a343b76d5aedb8270ed459bc189e3e407">end</a></div><div class="ttdeci">DynamicField&lt; point &gt; end(start.size())</div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a92dc814ea7fd34acae287945426740d3a0b8403fccaa9b51239c179649c6fcb50"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a92dc814ea7fd34acae287945426740d3a0b8403fccaa9b51239c179649c6fcb50">Foam::meshRefinement::MESH</a></div><div class="ttdef"><b>Definition:</b> <a href="meshRefinement_8H_source.html#l00093">meshRefinement.H:93</a></div></div>
<div class="ttc" id="namespaceFoam_html_a2db8fe02a0d3909e9351bb4275b23ce4"><div class="ttname"><a href="namespaceFoam.html#a2db8fe02a0d3909e9351bb4275b23ce4">Foam::endl</a></div><div class="ttdeci">Ostream &amp; endl(Ostream &amp;os)</div><div class="ttdoc">Add newline and flush stream. </div><div class="ttdef"><b>Definition:</b> <a href="Ostream_8H_source.html#l00445">Ostream.H:445</a></div></div>
<div class="ttc" id="mapDistributePolyMesh_8H_html"><div class="ttname"><a href="mapDistributePolyMesh_8H.html">mapDistributePolyMesh.H</a></div></div>
<div class="ttc" id="classFoam_1_1mapPolyMesh_html_a7e7aae2a61b34b47a470ad7821c4597a"><div class="ttname"><a href="classFoam_1_1mapPolyMesh.html#a7e7aae2a61b34b47a470ad7821c4597a">Foam::mapPolyMesh::hasMotionPoints</a></div><div class="ttdeci">bool hasMotionPoints() const </div><div class="ttdoc">Has valid preMotionPoints? </div><div class="ttdef"><b>Definition:</b> <a href="mapPolyMesh_8H_source.html#l00763">mapPolyMesh.H:763</a></div></div>
<div class="ttc" id="classFoam_1_1pTraits_html"><div class="ttname"><a href="classFoam_1_1pTraits.html">Foam::pTraits</a></div><div class="ttdoc">Traits class for primitives. </div><div class="ttdef"><b>Definition:</b> <a href="pTraits_8H_source.html#l00046">pTraits.H:46</a></div></div>
<div class="ttc" id="syncTools_8H_html"><div class="ttname"><a href="syncTools_8H.html">syncTools.H</a></div></div>
<div class="ttc" id="shootRays_8H_html_ac23c63c7750d8829a77f4ebe1d961c48"><div class="ttname"><a href="shootRays_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a></div><div class="ttdeci">label i</div><div class="ttdef"><b>Definition:</b> <a href="shootRays_8H_source.html#l00032">shootRays.H:32</a></div></div>
<div class="ttc" id="classFoam_1_1IOobject_html_a6d60057c26042eaf7fa1b3b6fb07b582"><div class="ttname"><a href="classFoam_1_1IOobject.html#a6d60057c26042eaf7fa1b3b6fb07b582">Foam::IOobject::name</a></div><div class="ttdeci">const word &amp; name() const </div><div class="ttdoc">Return name. </div><div class="ttdef"><b>Definition:</b> <a href="IOobjectI_8H_source.html#l00039">IOobjectI.H:39</a></div></div>
<div class="ttc" id="classFoam_1_1syncTools_html_a9fcea11b92f314969429f47360a0c8a7"><div class="ttname"><a href="classFoam_1_1syncTools.html#a9fcea11b92f314969429f47360a0c8a7">Foam::syncTools::syncFaceList</a></div><div class="ttdeci">static void syncFaceList(const polyMesh &amp;mesh, UList&lt; T &gt; &amp;faceValues, const CombineOp &amp;cop)</div><div class="ttdoc">Synchronize values on all mesh faces. </div><div class="ttdef"><b>Definition:</b> <a href="syncTools_8H_source.html#l00426">syncTools.H:426</a></div></div>
<div class="ttc" id="fvMeshDistribute_8H_html"><div class="ttname"><a href="fvMeshDistribute_8H.html">fvMeshDistribute.H</a></div></div>
<div class="ttc" id="namespaceFoam_html_a7ea82552101f041fad7635b3ed036a84"><div class="ttname"><a href="namespaceFoam.html#a7ea82552101f041fad7635b3ed036a84">Foam::vector</a></div><div class="ttdeci">Vector&lt; scalar &gt; vector</div><div class="ttdoc">A scalar version of the templated Vector. </div><div class="ttdef"><b>Definition:</b> <a href="vector_8H_source.html#l00047">vector.H:47</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_ac48500d1baf48dc03568d8fe5d7eddbb"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#ac48500d1baf48dc03568d8fe5d7eddbb">Foam::meshRefinement::directionalRefine</a></div><div class="ttdeci">autoPtr&lt; mapPolyMesh &gt; directionalRefine(const string &amp;msg, const direction cmpt, const labelList &amp;cellsToRefine)</div><div class="ttdoc">Directionally refine in direction cmpt. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l02756">meshRefinementRefine.C:2756</a></div></div>
<div class="ttc" id="classFoam_1_1cellCuts_html"><div class="ttname"><a href="classFoam_1_1cellCuts.html">Foam::cellCuts</a></div><div class="ttdoc">Description of cuts across cells. </div><div class="ttdef"><b>Definition:</b> <a href="cellCuts_8H_source.html#l00106">cellCuts.H:106</a></div></div>
<div class="ttc" id="classFoam_1_1primitiveMesh_html_a5838384c0cea399b56339f30bc8558ab"><div class="ttname"><a href="classFoam_1_1primitiveMesh.html#a5838384c0cea399b56339f30bc8558ab">Foam::primitiveMesh::cells</a></div><div class="ttdeci">const cellList &amp; cells() const </div><div class="ttdef"><b>Definition:</b> <a href="primitiveMeshCells_8C_source.html#l00131">primitiveMeshCells.C:131</a></div></div>
<div class="ttc" id="namespaceFoam_html_aa94edac9dd43dd3114964d552001710e"><div class="ttname"><a href="namespaceFoam.html#aa94edac9dd43dd3114964d552001710e">Foam::less</a></div><div class="ttdeci">static bool less(const vector &amp;x, const vector &amp;y)</div><div class="ttdoc">To compare normals. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l00052">meshRefinementRefine.C:52</a></div></div>
<div class="ttc" id="classFoam_1_1polyMesh_html_a6b7f5ba89250dbd7a1c6c7860ab60fe3"><div class="ttname"><a href="classFoam_1_1polyMesh.html#a6b7f5ba89250dbd7a1c6c7860ab60fe3">Foam::polyMesh::boundaryMesh</a></div><div class="ttdeci">const polyBoundaryMesh &amp; boundaryMesh() const </div><div class="ttdoc">Return boundary mesh. </div><div class="ttdef"><b>Definition:</b> <a href="polyMesh_8H_source.html#l00549">polyMesh.H:549</a></div></div>
<div class="ttc" id="classFoam_1_1primitiveMesh_html_a3078ec5cedf6305a3e5781a7d005f0fc"><div class="ttname"><a href="classFoam_1_1primitiveMesh.html#a3078ec5cedf6305a3e5781a7d005f0fc">Foam::primitiveMesh::nInternalFaces</a></div><div class="ttdeci">label nInternalFaces() const </div><div class="ttdoc">Number of internal faces. </div><div class="ttdef"><b>Definition:</b> <a href="primitiveMeshI_8H_source.html#l00071">primitiveMeshI.H:71</a></div></div>
<div class="ttc" id="namespaceFoam_html_a71a8a9ecd1d9f82f943b2479f9ab8910"><div class="ttname"><a href="namespaceFoam.html#a71a8a9ecd1d9f82f943b2479f9ab8910">Foam::vectorList</a></div><div class="ttdeci">List&lt; vector &gt; vectorList</div><div class="ttdoc">A List of vectors. </div><div class="ttdef"><b>Definition:</b> <a href="vectorList_8H_source.html#l00061">vectorList.H:61</a></div></div>
<div class="ttc" id="classFoam_1_1syncTools_html_aff3eb0f0b83158bb7913499166eb99f7"><div class="ttname"><a href="classFoam_1_1syncTools.html#aff3eb0f0b83158bb7913499166eb99f7">Foam::syncTools::syncBoundaryFaceList</a></div><div class="ttdeci">static void syncBoundaryFaceList(const polyMesh &amp;mesh, UList&lt; T &gt; &amp;faceValues, const CombineOp &amp;cop, const TransformOp &amp;top, const bool parRun=Pstream::parRun())</div><div class="ttdoc">Synchronize values on boundary faces only. </div><div class="ttdef"><b>Definition:</b> <a href="syncToolsTemplates_8C_source.html#l00920">syncToolsTemplates.C:920</a></div></div>
<div class="ttc" id="classFoam_1_1mapPolyMesh_html"><div class="ttname"><a href="classFoam_1_1mapPolyMesh.html">Foam::mapPolyMesh</a></div><div class="ttdoc">Class containing mesh-to-mesh mapping information after a change in polyMesh topology. </div><div class="ttdef"><b>Definition:</b> <a href="mapPolyMesh_8H_source.html#l00156">mapPolyMesh.H:156</a></div></div>
<div class="ttc" id="structFoam_1_1sumOp_html"><div class="ttname"><a href="structFoam_1_1sumOp.html">Foam::sumOp</a></div><div class="ttdef"><b>Definition:</b> <a href="ops_8H_source.html#l00207">ops.H:207</a></div></div>
<div class="ttc" id="stdFoam_8H_html_a1a02bffef961ee015f0e9b03d336c6a9"><div class="ttname"><a href="stdFoam_8H.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a></div><div class="ttdeci">#define forAll(list, i)</div><div class="ttdoc">Loop across all elements in list. </div><div class="ttdef"><b>Definition:</b> <a href="stdFoam_8H_source.html#l00347">stdFoam.H:347</a></div></div>
<div class="ttc" id="Cloud_8H_html"><div class="ttname"><a href="Cloud_8H.html">Cloud.H</a></div></div>
<div class="ttc" id="LISASMDCalcMethod2_8H_html_a9336ebf25087d91c818ee6e9ec29f8c1"><div class="ttname"><a href="LISASMDCalcMethod2_8H.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a></div><div class="ttdeci">x</div><div class="ttdef"><b>Definition:</b> <a href="LISASMDCalcMethod2_8H_source.html#l00052">LISASMDCalcMethod2.H:52</a></div></div>
<div class="ttc" id="cellSet_8H_html"><div class="ttname"><a href="cellSet_8H.html">cellSet.H</a></div></div>
<div class="ttc" id="namespaceFoam_1_1HashTableOps_html_ac4b37690391dc27447cbff9181265054"><div class="ttname"><a href="namespaceFoam_1_1HashTableOps.html#ac4b37690391dc27447cbff9181265054">Foam::HashTableOps::values</a></div><div class="ttdeci">List&lt; T &gt; values(const HashTable&lt; T, Key, Hash &gt; &amp;tbl, const bool doSort=false)</div><div class="ttdoc">List of values from HashTable, optionally sorted. </div><div class="ttdef"><b>Definition:</b> <a href="HashOps_8H_source.html#l00164">HashOps.H:164</a></div></div>
<div class="ttc" id="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H_html_a2f677c654c2b7f157710d334624b8800"><div class="ttname"><a href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H.html#a2f677c654c2b7f157710d334624b8800">timeName</a></div><div class="ttdeci">word timeName</div><div class="ttdef"><b>Definition:</b> <a href="mesh_2conversion_2ccm_2foamToCcm_2getTimeIndex_8H_source.html#l00003">getTimeIndex.H:3</a></div></div>
<div class="ttc" id="namespaceFoam_html_a305f9dfab260ac25843146dda3a71e71"><div class="ttname"><a href="namespaceFoam.html#a305f9dfab260ac25843146dda3a71e71">Foam::start</a></div><div class="ttdeci">label ListType::const_reference const label start</div><div class="ttdef"><b>Definition:</b> <a href="ListOps_8H_source.html#l00499">ListOps.H:499</a></div></div>
<div class="ttc" id="classFoam_1_1bitSet_html_a3218a20f524e7d608e091aee8588dd46"><div class="ttname"><a href="classFoam_1_1bitSet.html#a3218a20f524e7d608e091aee8588dd46">Foam::bitSet::test</a></div><div class="ttdeci">bool test(const label pos) const </div><div class="ttdoc">Test value at specified position, never auto-vivify entries. </div><div class="ttdef"><b>Definition:</b> <a href="bitSetI_8H_source.html#l00505">bitSetI.H:505</a></div></div>
<div class="ttc" id="LISASMDCalcMethod1_8H_html_afa8b67a0d5607da908ad92ed485e19e8"><div class="ttname"><a href="LISASMDCalcMethod1_8H.html#afa8b67a0d5607da908ad92ed485e19e8">y</a></div><div class="ttdeci">scalar y</div><div class="ttdef"><b>Definition:</b> <a href="LISASMDCalcMethod1_8H_source.html#l00014">LISASMDCalcMethod1.H:14</a></div></div>
<div class="ttc" id="namespaceFoam_1_1vtk_html_a5ddab0eba69f47ec148a4a5f9d8f334a"><div class="ttname"><a href="namespaceFoam_1_1vtk.html#a5ddab0eba69f47ec148a4a5f9d8f334a">Foam::vtk::write</a></div><div class="ttdeci">void write(vtk::formatter &amp;fmt, const Type &amp;val, const label n=1)</div><div class="ttdoc">Component-wise write of a value (N times) </div><div class="ttdef"><b>Definition:</b> <a href="foamVtkOutputTemplates_8C_source.html#l00028">foamVtkOutputTemplates.C:28</a></div></div>
<div class="ttc" id="structFoam_1_1orEqOp_html"><div class="ttname"><a href="structFoam_1_1orEqOp.html">Foam::orEqOp</a></div><div class="ttdef"><b>Definition:</b> <a href="ops_8H_source.html#l00080">ops.H:80</a></div></div>
<div class="ttc" id="shellSurfaces_8H_html"><div class="ttname"><a href="shellSurfaces_8H.html">shellSurfaces.H</a></div></div>
<div class="ttc" id="namespaceFoam_html_a5997a67f2e85a15c0e13a1724273aa5f"><div class="ttname"><a href="namespaceFoam.html#a5997a67f2e85a15c0e13a1724273aa5f">Foam::pointField</a></div><div class="ttdeci">vectorField pointField</div><div class="ttdoc">pointField is a vectorField. </div><div class="ttdef"><b>Definition:</b> <a href="pointFieldFwd_8H_source.html#l00038">pointFieldFwd.H:38</a></div></div>
<div class="ttc" id="namespaceFoam_1_1constant_1_1electromagnetic_html_a1885f51cb0544664f4e80e895d163fc8"><div class="ttname"><a href="namespaceFoam_1_1constant_1_1electromagnetic.html#a1885f51cb0544664f4e80e895d163fc8">Foam::constant::electromagnetic::e</a></div><div class="ttdeci">const dimensionedScalar e</div><div class="ttdoc">Elementary charge. </div><div class="ttdef"><b>Definition:</b> <a href="solvers_2compressible_2rhoCentralFoam_2createFields_8H_source.html#l00011">createFields.H:11</a></div></div>
<div class="ttc" id="classFoam_1_1List_html_a3eb74b6b9f8c1346a09c49e3eade797c"><div class="ttname"><a href="classFoam_1_1List.html#a3eb74b6b9f8c1346a09c49e3eade797c">Foam::List::setSize</a></div><div class="ttdeci">void setSize(const label newSize)</div><div class="ttdoc">Alias for resize(const label) </div><div class="ttdef"><b>Definition:</b> <a href="ListI_8H_source.html#l00139">ListI.H:139</a></div></div>
<div class="ttc" id="namespaceFoam_html_aebb41a148f7cf44b63e12f69e487e49f"><div class="ttname"><a href="namespaceFoam.html#aebb41a148f7cf44b63e12f69e487e49f">Foam::cos</a></div><div class="ttdeci">dimensionedScalar cos(const dimensionedScalar &amp;ds)</div><div class="ttdef"><b>Definition:</b> <a href="dimensionedScalar_8C_source.html#l00258">dimensionedScalar.C:258</a></div></div>
<div class="ttc" id="gmvOutputHeader_8H_html_a4f5b52d99e5c7bbb6b34b2f6e27e73d1"><div class="ttname"><a href="gmvOutputHeader_8H.html#a4f5b52d99e5c7bbb6b34b2f6e27e73d1">cells</a></div><div class="ttdeci">const cellShapeList &amp; cells</div><div class="ttdef"><b>Definition:</b> <a href="gmvOutputHeader_8H_source.html#l00003">gmvOutputHeader.H:3</a></div></div>
<div class="ttc" id="polyTopoChange_8H_html"><div class="ttname"><a href="polyTopoChange_8H.html">polyTopoChange.H</a></div></div>
<div class="ttc" id="classFoam_1_1polyPatch_html_a861f370e41af7d54d7ff91da65de6e6a"><div class="ttname"><a href="classFoam_1_1polyPatch.html#a861f370e41af7d54d7ff91da65de6e6a">Foam::polyPatch::start</a></div><div class="ttdeci">label start() const </div><div class="ttdoc">Return start label of this patch in the polyMesh face list. </div><div class="ttdef"><b>Definition:</b> <a href="polyPatch_8H_source.html#l00374">polyPatch.H:374</a></div></div>
<div class="ttc" id="hexCellLooper_8H_html"><div class="ttname"><a href="hexCellLooper_8H.html">hexCellLooper.H</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_ac205e187b0cac287f346f71f7f170f00"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#ac205e187b0cac287f346f71f7f170f00">Foam::meshRefinement::refineAndBalance</a></div><div class="ttdeci">autoPtr&lt; mapDistributePolyMesh &gt; refineAndBalance(const string &amp;msg, decompositionMethod &amp;decomposer, fvMeshDistribute &amp;distributor, const labelList &amp;cellsToRefine, const scalar maxLoadUnbalance)</div><div class="ttdoc">Refine some cells and rebalance. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l02395">meshRefinementRefine.C:2395</a></div></div>
<div class="ttc" id="classFoam_1_1Field_html"><div class="ttname"><a href="classFoam_1_1Field.html">Foam::Field&lt; vector &gt;</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a92dc814ea7fd34acae287945426740d3a0efd996e92377188d981c034a3952cc7"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a92dc814ea7fd34acae287945426740d3a0efd996e92377188d981c034a3952cc7">Foam::meshRefinement::FEATURESEEDS</a></div><div class="ttdef"><b>Definition:</b> <a href="meshRefinement_8H_source.html#l00095">meshRefinement.H:95</a></div></div>
<div class="ttc" id="namespaceFoam_1_1constant_1_1physicoChemical_html_a00faad9a19c0dc0bcae765415926e925"><div class="ttname"><a href="namespaceFoam_1_1constant_1_1physicoChemical.html#a00faad9a19c0dc0bcae765415926e925">Foam::constant::physicoChemical::b</a></div><div class="ttdeci">const dimensionedScalar b</div><div class="ttdoc">Wien displacement law constant: default SI units: [m.K]. </div><div class="ttdef"><b>Definition:</b> <a href="solvers_2combustion_2PDRFoam_2createFields_8H_source.html#l00027">createFields.H:27</a></div></div>
<div class="ttc" id="namespaceFoam_html_adb8ca783445fee992edbb6129fc12148"><div class="ttname"><a href="namespaceFoam.html#adb8ca783445fee992edbb6129fc12148">Foam::Swap</a></div><div class="ttdeci">void Swap(DynamicList&lt; T, SizeMin1 &gt; &amp;a, DynamicList&lt; T, SizeMin2 &gt; &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="DynamicListI_8H_source.html#l00902">DynamicListI.H:902</a></div></div>
<div class="ttc" id="namespaceFoam_html_a6e363d070e971ead1a4c40475084e584"><div class="ttname"><a href="namespaceFoam.html#a6e363d070e971ead1a4c40475084e584">Foam::scalarField</a></div><div class="ttdeci">Field&lt; scalar &gt; scalarField</div><div class="ttdoc">Specialisation of Field&amp;lt;T&amp;gt; for scalar. </div><div class="ttdef"><b>Definition:</b> <a href="primitiveFieldsFwd_8H_source.html#l00046">primitiveFieldsFwd.H:46</a></div></div>
<div class="ttc" id="meshCutter_8H_html"><div class="ttname"><a href="meshCutter_8H.html">meshCutter.H</a></div></div>
<div class="ttc" id="classFoam_1_1normalLess_html_a1e83d4b24a77ad6e5e2270d6809c6195"><div class="ttname"><a href="classFoam_1_1normalLess.html#a1e83d4b24a77ad6e5e2270d6809c6195">Foam::normalLess::operator()</a></div><div class="ttdeci">bool operator()(const label a, const label b) const </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l00084">meshRefinementRefine.C:84</a></div></div>
<div class="ttc" id="classFoam_1_1meshCutter_html"><div class="ttname"><a href="classFoam_1_1meshCutter.html">Foam::meshCutter</a></div><div class="ttdoc">Cuts (splits) cells. </div><div class="ttdef"><b>Definition:</b> <a href="meshCutter_8H_source.html#l00133">meshCutter.H:133</a></div></div>
<div class="ttc" id="classFoam_1_1globalMeshData_html_ae81fd4f10de744d66755bdc63b3bba79"><div class="ttname"><a href="classFoam_1_1globalMeshData.html#ae81fd4f10de744d66755bdc63b3bba79">Foam::globalMeshData::nTotalFaces</a></div><div class="ttdeci">label nTotalFaces() const </div><div class="ttdoc">Return total number of faces in decomposed mesh. Not. </div><div class="ttdef"><b>Definition:</b> <a href="globalMeshData_8H_source.html#l00476">globalMeshData.H:476</a></div></div>
<div class="ttc" id="refineCell_8H_html"><div class="ttname"><a href="refineCell_8H.html">refineCell.H</a></div></div>
<div class="ttc" id="refinementFeatures_8H_html"><div class="ttname"><a href="refinementFeatures_8H.html">refinementFeatures.H</a></div></div>
<div class="ttc" id="namespaceFoam_html_a96b65441175bbfb9a869045dc05fb0b9"><div class="ttname"><a href="namespaceFoam.html#a96b65441175bbfb9a869045dc05fb0b9">Foam::min</a></div><div class="ttdeci">label min(const labelHashSet &amp;set, label minValue=labelMax)</div><div class="ttdoc">Find the min value in labelHashSet, optionally limited by second argument. </div><div class="ttdef"><b>Definition:</b> <a href="hashSets_8C_source.html#l00026">hashSets.C:26</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a2c7b53bf05093baefe6bbcbeccc12b59"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a2c7b53bf05093baefe6bbcbeccc12b59">Foam::meshRefinement::isGap</a></div><div class="ttdeci">bool isGap(const scalar, const vector &amp;, const vector &amp;, const vector &amp;, const vector &amp;) const </div><div class="ttdoc">Is local topology a small gap? </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l01533">meshRefinementRefine.C:1533</a></div></div>
<div class="ttc" id="classFoam_1_1primitiveMesh_html_ac2e4cb144010acc4855a5c909f2167b2"><div class="ttname"><a href="classFoam_1_1primitiveMesh.html#ac2e4cb144010acc4855a5c909f2167b2">Foam::primitiveMesh::nBoundaryFaces</a></div><div class="ttdeci">label nBoundaryFaces() const </div><div class="ttdoc">Number of boundary faces (== nFaces - nInternalFaces) </div><div class="ttdef"><b>Definition:</b> <a href="primitiveMeshI_8H_source.html#l00077">primitiveMeshI.H:77</a></div></div>
<div class="ttc" id="classFoam_1_1polyMesh_html_ad152d9d2d71b7bb6ab77c5ef580cb8ee"><div class="ttname"><a href="classFoam_1_1polyMesh.html#ad152d9d2d71b7bb6ab77c5ef580cb8ee">Foam::polyMesh::globalData</a></div><div class="ttdeci">const globalMeshData &amp; globalData() const </div><div class="ttdoc">Return parallel info. </div><div class="ttdef"><b>Definition:</b> <a href="polyMesh_8C_source.html#l01234">polyMesh.C:1234</a></div></div>
<div class="ttc" id="classFoam_1_1VectorSpace_html_a6c54998a8606a6180b6b70b7b629ae4e"><div class="ttname"><a href="classFoam_1_1VectorSpace.html#a6c54998a8606a6180b6b70b7b629ae4e">Foam::VectorSpace&lt; Vector&lt; scalar &gt;, scalar, 3 &gt;::nComponents</a></div><div class="ttdeci">static constexpr direction nComponents</div><div class="ttdoc">Number of components in this vector space. </div><div class="ttdef"><b>Definition:</b> <a href="VectorSpace_8H_source.html#l00109">VectorSpace.H:109</a></div></div>
<div class="ttc" id="classFoam_1_1Vector_html"><div class="ttname"><a href="classFoam_1_1Vector.html">Foam::Vector&lt; scalar &gt;</a></div></div>
<div class="ttc" id="incompressible_2pimpleFoam_2overPimpleDyMFoam_2correctPhi_8H_html_a98851422016028c0bdb57cfcaf8c70a5"><div class="ttname"><a href="incompressible_2pimpleFoam_2overPimpleDyMFoam_2correctPhi_8H.html#a98851422016028c0bdb57cfcaf8c70a5">refCells</a></div><div class="ttdeci">labelList refCells(nZones,-1)</div></div>
<div class="ttc" id="namespaceFoam_html_a7ffd6af4acc2eb9ba72ee296b5ecda23"><div class="ttname"><a href="namespaceFoam.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">Foam::reduce</a></div><div class="ttdeci">void reduce(const List&lt; UPstream::commsStruct &gt; &amp;comms, T &amp;Value, const BinaryOp &amp;bop, const int tag, const label comm)</div><div class="ttdef"><b>Definition:</b> <a href="PstreamReduceOps_8H_source.html#l00045">PstreamReduceOps.H:45</a></div></div>
<div class="ttc" id="decompositionMethod_8H_html"><div class="ttname"><a href="decompositionMethod_8H.html">decompositionMethod.H</a></div></div>
<div class="ttc" id="classFoam_1_1mapPolyMesh_html_a6a7e1b193949c9f7a78bcbe91147dad8"><div class="ttname"><a href="classFoam_1_1mapPolyMesh.html#a6a7e1b193949c9f7a78bcbe91147dad8">Foam::mapPolyMesh::nOldCells</a></div><div class="ttdeci">label nOldCells() const </div><div class="ttdoc">Number of old cells. </div><div class="ttdef"><b>Definition:</b> <a href="mapPolyMesh_8H_source.html#l00468">mapPolyMesh.H:468</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_ac9571690bc552fe5150042c81c4f8229"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#ac9571690bc552fe5150042c81c4f8229">Foam::meshRefinement::refine</a></div><div class="ttdeci">autoPtr&lt; mapPolyMesh &gt; refine(const labelList &amp;cellsToRefine)</div><div class="ttdoc">Refine some cells. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l02353">meshRefinementRefine.C:2353</a></div></div>
<div class="ttc" id="classFoam_1_1syncTools_html_ac509eef6db47b0b87366229f2fb017f9"><div class="ttname"><a href="classFoam_1_1syncTools.html#ac509eef6db47b0b87366229f2fb017f9">Foam::syncTools::swapBoundaryCellList</a></div><div class="ttdeci">static void swapBoundaryCellList(const polyMesh &amp;mesh, const UList&lt; T &gt; &amp;cellData, List&lt; T &gt; &amp;neighbourCellData)</div><div class="ttdoc">Swap to obtain neighbour cell values for all boundary faces. </div><div class="ttdef"><b>Definition:</b> <a href="syncToolsTemplates_8C_source.html#l01168">syncToolsTemplates.C:1168</a></div></div>
<div class="ttc" id="classFoam_1_1normalLess_html"><div class="ttname"><a href="classFoam_1_1normalLess.html">Foam::normalLess</a></div><div class="ttdoc">To compare normals. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l00073">meshRefinementRefine.C:73</a></div></div>
<div class="ttc" id="classFoam_1_1UPstream_html_aada0e04d8127eda8ee95be0772754a4f"><div class="ttname"><a href="classFoam_1_1UPstream.html#aada0e04d8127eda8ee95be0772754a4f">Foam::UPstream::nProcs</a></div><div class="ttdeci">static label nProcs(const label communicator=0)</div><div class="ttdoc">Number of processes in parallel run. </div><div class="ttdef"><b>Definition:</b> <a href="UPstream_8H_source.html#l00538">UPstream.H:538</a></div></div>
<div class="ttc" id="namespaceFoam_html_ae99c179eee737907d850a9d85d619b6b"><div class="ttname"><a href="namespaceFoam.html#ae99c179eee737907d850a9d85d619b6b">Foam::labelUIndList</a></div><div class="ttdeci">UIndirectList&lt; label &gt; labelUIndList</div><div class="ttdoc">UIndirectList of labels. </div><div class="ttdef"><b>Definition:</b> <a href="UIndirectList_8H_source.html#l00055">UIndirectList.H:55</a></div></div>
<div class="ttc" id="classFoam_1_1polyMesh_html_ad03ef02786858ab9d5e2776a4731c77c"><div class="ttname"><a href="classFoam_1_1polyMesh.html#ad03ef02786858ab9d5e2776a4731c77c">Foam::polyMesh::faceNeighbour</a></div><div class="ttdeci">virtual const labelList &amp; faceNeighbour() const </div><div class="ttdoc">Return face neighbour. </div><div class="ttdef"><b>Definition:</b> <a href="polyMesh_8C_source.html#l01075">polyMesh.C:1075</a></div></div>
<div class="ttc" id="namespaceFoam_html_a643590f4015338d12714af03d61a0ac9"><div class="ttname"><a href="namespaceFoam.html#a643590f4015338d12714af03d61a0ac9">Foam::point</a></div><div class="ttdeci">vector point</div><div class="ttdoc">Point is a vector. </div><div class="ttdef"><b>Definition:</b> <a href="point_8H_source.html#l00037">point.H:37</a></div></div>
<div class="ttc" id="classFoam_1_1primitiveMesh_html_ae1fbe690fc3c47739168a97f79907217"><div class="ttname"><a href="classFoam_1_1primitiveMesh.html#ae1fbe690fc3c47739168a97f79907217">Foam::primitiveMesh::nFaces</a></div><div class="ttdeci">label nFaces() const </div><div class="ttdoc">Number of mesh faces. </div><div class="ttdef"><b>Definition:</b> <a href="primitiveMeshI_8H_source.html#l00083">primitiveMeshI.H:83</a></div></div>
<div class="ttc" id="classFoam_1_1bitSet_html"><div class="ttname"><a href="classFoam_1_1bitSet.html">Foam::bitSet</a></div><div class="ttdoc">A bitSet stores bits (elements with only two states) in packed internal format and supports a variety...</div><div class="ttdef"><b>Definition:</b> <a href="bitSet_8H_source.html#l00060">bitSet.H:60</a></div></div>
<div class="ttc" id="classFoam_1_1mapPolyMesh_html_a08afe30a689e98e3d34420f8258e573a"><div class="ttname"><a href="classFoam_1_1mapPolyMesh.html#a08afe30a689e98e3d34420f8258e573a">Foam::mapPolyMesh::cellMap</a></div><div class="ttdeci">const labelList &amp; cellMap() const </div><div class="ttdoc">Old cell map. </div><div class="ttdef"><b>Definition:</b> <a href="mapPolyMesh_8H_source.html#l00533">mapPolyMesh.H:533</a></div></div>
<div class="ttc" id="classFoam_1_1cell_html"><div class="ttname"><a href="classFoam_1_1cell.html">Foam::cell</a></div><div class="ttdoc">A cell is defined as a list of faces with extra functionality. </div><div class="ttdef"><b>Definition:</b> <a href="cell_8H_source.html#l00050">cell.H:50</a></div></div>
<div class="ttc" id="classFoam_1_1hexCellLooper_html"><div class="ttname"><a href="classFoam_1_1hexCellLooper.html">Foam::hexCellLooper</a></div><div class="ttdoc">Implementation of cellLooper. </div><div class="ttdef"><b>Definition:</b> <a href="hexCellLooper_8H_source.html#l00058">hexCellLooper.H:58</a></div></div>
<div class="ttc" id="classFoam_1_1polyTopoChange_html"><div class="ttname"><a href="classFoam_1_1polyTopoChange.html">Foam::polyTopoChange</a></div><div class="ttdoc">Direct mesh changes based on v1.3 polyTopoChange syntax. </div><div class="ttdef"><b>Definition:</b> <a href="polyTopoChange_8H_source.html#l00096">polyTopoChange.H:96</a></div></div>
<div class="ttc" id="classFoam_1_1normalLess_html_a69c8a68d0a59e11d6548df2727a34d4f"><div class="ttname"><a href="classFoam_1_1normalLess.html#a69c8a68d0a59e11d6548df2727a34d4f">Foam::normalLess::normalLess</a></div><div class="ttdeci">normalLess(const vectorList &amp;values)</div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l00079">meshRefinementRefine.C:79</a></div></div>
<div class="ttc" id="cellCuts_8H_html"><div class="ttname"><a href="cellCuts_8H.html">cellCuts.H</a></div></div>
<div class="ttc" id="shootRays_8H_html_a26c8668e6da16a9f1bf37a8829e5a7db"><div class="ttname"><a href="shootRays_8H.html#a26c8668e6da16a9f1bf37a8829e5a7db">j</a></div><div class="ttdeci">label j</div><div class="ttdef"><b>Definition:</b> <a href="shootRays_8H_source.html#l00033">shootRays.H:33</a></div></div>
<div class="ttc" id="namespaceFoam_html_a501e80d1e14c94973e82f1555e7eb711"><div class="ttname"><a href="namespaceFoam.html#a501e80d1e14c94973e82f1555e7eb711">Foam::Info</a></div><div class="ttdeci">messageStream Info</div><div class="ttdoc">Information stream (uses stdout - output is on the master only) </div></div>
<div class="ttc" id="namespaceFoam_html_a700fe3bfa3b7c2f5937307d76372ab4e"><div class="ttname"><a href="namespaceFoam.html#a700fe3bfa3b7c2f5937307d76372ab4e">Foam::labelMax</a></div><div class="ttdeci">constexpr label labelMax</div><div class="ttdef"><b>Definition:</b> <a href="label_8H_source.html#l00059">label.H:59</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a4376f23cd92e9a8416762b079ce7a0c9"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a4376f23cd92e9a8416762b079ce7a0c9">Foam::meshRefinement::writeType</a></div><div class="ttdeci">writeType</div><div class="ttdoc">Enumeration for what to write. Used as a bit-pattern. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinement_8H_source.html#l00113">meshRefinement.H:113</a></div></div>
<div class="ttc" id="classFoam_1_1mapPolyMesh_html_a2e8e4273c887a677b7822169559781ef"><div class="ttname"><a href="classFoam_1_1mapPolyMesh.html#a2e8e4273c887a677b7822169559781ef">Foam::mapPolyMesh::preMotionPoints</a></div><div class="ttdeci">const pointField &amp; preMotionPoints() const </div><div class="ttdoc">Pre-motion point positions. </div><div class="ttdef"><b>Definition:</b> <a href="mapPolyMesh_8H_source.html#l00755">mapPolyMesh.H:755</a></div></div>
<div class="ttc" id="namespaceFoam_html_aa6a94734c26b4f5d0008931862eddcd8"><div class="ttname"><a href="namespaceFoam.html#aa6a94734c26b4f5d0008931862eddcd8">Foam::vectorField</a></div><div class="ttdeci">Field&lt; vector &gt; vectorField</div><div class="ttdoc">Specialisation of Field&amp;lt;T&amp;gt; for vector. </div><div class="ttdef"><b>Definition:</b> <a href="primitiveFieldsFwd_8H_source.html#l00048">primitiveFieldsFwd.H:48</a></div></div>
<div class="ttc" id="namespaceFoam_html_a8d528a67d2a9c6fe4fb94bc86872624b"><div class="ttname"><a href="namespaceFoam.html#a8d528a67d2a9c6fe4fb94bc86872624b">Foam::returnReduce</a></div><div class="ttdeci">T returnReduce(const T &amp;Value, const BinaryOp &amp;bop, const int tag=Pstream::msgType(), const label comm=UPstream::worldComm)</div><div class="ttdef"><b>Definition:</b> <a href="PstreamReduceOps_8H_source.html#l00088">PstreamReduceOps.H:88</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a17de2ab00585c887fc4fc7154fc85fcd"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a17de2ab00585c887fc4fc7154fc85fcd">Foam::meshRefinement::directionalRefineCandidates</a></div><div class="ttdeci">labelList directionalRefineCandidates(const label maxGlobalCells, const label maxLocalCells, const labelList &amp;currentLevel, const direction dir) const </div><div class="ttdoc">Calculate list of cells to directionally refine. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l02656">meshRefinementRefine.C:2656</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a92dc814ea7fd34acae287945426740d3"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a92dc814ea7fd34acae287945426740d3">Foam::meshRefinement::debugType</a></div><div class="ttdeci">debugType</div><div class="ttdoc">Enumeration for what to debug. Used as a bit-pattern. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinement_8H_source.html#l00091">meshRefinement.H:91</a></div></div>
<div class="ttc" id="meshRefinement_8H_html"><div class="ttname"><a href="meshRefinement_8H.html">meshRefinement.H</a></div></div>
<div class="ttc" id="classFoam_1_1autoPtr_html"><div class="ttname"><a href="classFoam_1_1autoPtr.html">Foam::autoPtr</a></div><div class="ttdoc">Pointer management similar to std::unique_ptr, with some additional methods and type checking...</div><div class="ttdef"><b>Definition:</b> <a href="HashPtrTable_8H_source.html#l00049">HashPtrTable.H:49</a></div></div>
<div class="ttc" id="classFoam_1_1polyMesh_html"><div class="ttname"><a href="classFoam_1_1polyMesh.html">Foam::polyMesh</a></div><div class="ttdoc">Mesh consisting of general polyhedral cells. </div><div class="ttdef"><b>Definition:</b> <a href="polyMesh_8H_source.html#l00073">polyMesh.H:73</a></div></div>
<div class="ttc" id="classFoam_1_1VectorSpace_html_a058151225b5fb26e4a5a4f039b0c1fa1"><div class="ttname"><a href="classFoam_1_1VectorSpace.html#a058151225b5fb26e4a5a4f039b0c1fa1">Foam::VectorSpace&lt; Vector&lt; scalar &gt;, scalar, 3 &gt;::zero</a></div><div class="ttdeci">static const Vector&lt; scalar &gt; zero</div><div class="ttdef"><b>Definition:</b> <a href="VectorSpace_8H_source.html#l00123">VectorSpace.H:123</a></div></div>
<div class="ttc" id="classFoam_1_1surfaceLocation_html"><div class="ttname"><a href="classFoam_1_1surfaceLocation.html">Foam::surfaceLocation</a></div><div class="ttdoc">Contains information about location on a triSurface. </div><div class="ttdef"><b>Definition:</b> <a href="surfaceLocation_8H_source.html#l00071">surfaceLocation.H:71</a></div></div>
<div class="ttc" id="namespaceFoam_html_a24c22a63812a3886a7f46967366a0671"><div class="ttname"><a href="namespaceFoam.html#a24c22a63812a3886a7f46967366a0671">Foam::labelList</a></div><div class="ttdeci">List&lt; label &gt; labelList</div><div class="ttdoc">A List of labels. </div><div class="ttdef"><b>Definition:</b> <a href="List_8H_source.html#l00070">List.H:70</a></div></div>
<div class="ttc" id="classFoam_1_1polyMesh_html_a6d4def83436c9aa4dc68e8e42c5cf268"><div class="ttname"><a href="classFoam_1_1polyMesh.html#a6d4def83436c9aa4dc68e8e42c5cf268">Foam::polyMesh::faceOwner</a></div><div class="ttdeci">virtual const labelList &amp; faceOwner() const </div><div class="ttdoc">Return face owner. </div><div class="ttdef"><b>Definition:</b> <a href="polyMesh_8C_source.html#l01069">polyMesh.C:1069</a></div></div>
<div class="ttc" id="classFoam_1_1polyPatch_html"><div class="ttname"><a href="classFoam_1_1polyPatch.html">Foam::polyPatch</a></div><div class="ttdoc">A patch is a list of labels that address the faces in the global face list. </div><div class="ttdef"><b>Definition:</b> <a href="polyPatch_8H_source.html#l00062">polyPatch.H:62</a></div></div>
<div class="ttc" id="OBJstream_8H_html"><div class="ttname"><a href="OBJstream_8H.html">OBJstream.H</a></div></div>
<div class="ttc" id="namespaceFoam_html_a29bdf29209233267101e6fc9463dabf1"><div class="ttname"><a href="namespaceFoam.html#a29bdf29209233267101e6fc9463dabf1">Foam::degToRad</a></div><div class="ttdeci">constexpr scalar degToRad(const scalar deg) noexcept</div><div class="ttdoc">Conversion from degrees to radians. </div><div class="ttdef"><b>Definition:</b> <a href="unitConversion_8H_source.html#l00044">unitConversion.H:44</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a9687e6999ad5ae21072ec74623f049ff"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a9687e6999ad5ae21072ec74623f049ff">Foam::meshRefinement::mesh</a></div><div class="ttdeci">const fvMesh &amp; mesh() const </div><div class="ttdoc">Reference to mesh. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinement_8H_source.html#l01135">meshRefinement.H:1135</a></div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a26f145e291841488338b3c35a60e4dd2"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a26f145e291841488338b3c35a60e4dd2">Foam::meshRefinement::isNormalGap</a></div><div class="ttdeci">bool isNormalGap(const scalar planarCos, const label level0, const vector &amp;point0, const vector &amp;normal0, const label level1, const vector &amp;point1, const vector &amp;normal1) const </div><div class="ttdoc">Is local topology a small gap normal to the test vector. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l01583">meshRefinementRefine.C:1583</a></div></div>
<div class="ttc" id="foamToVTK_2convertVolumeFields_8H_html_a9501f0803dc8f7696580ce88cb134264"><div class="ttname"><a href="foamToVTK_2convertVolumeFields_8H.html#a9501f0803dc8f7696580ce88cb134264">set</a></div><div class="ttdeci">patchWriters set(0, writer)</div></div>
<div class="ttc" id="classFoam_1_1meshRefinement_html_a7542c70fe09fdad6d37c733d83a4d96d"><div class="ttname"><a href="classFoam_1_1meshRefinement.html#a7542c70fe09fdad6d37c733d83a4d96d">Foam::meshRefinement::refineCandidates</a></div><div class="ttdeci">labelList refineCandidates(const pointField &amp;keepPoints, const scalar curvature, const scalar planarAngle, const bool featureRefinement, const bool featureDistanceRefinement, const bool internalRefinement, const bool surfaceRefinement, const bool curvatureRefinement, const bool smallFeatureRefinement, const bool gapRefinement, const bool bigGapRefinement, const bool spreadGapSize, const label maxGlobalCells, const label maxLocalCells) const </div><div class="ttdoc">Calculate list of cells to refine. </div><div class="ttdef"><b>Definition:</b> <a href="meshRefinementRefine_8C_source.html#l02043">meshRefinementRefine.C:2043</a></div></div>
<div class="ttc" id="namespaceFoam_html_ad20c8f17b81fbe92f6dd235121ca1de9"><div class="ttname"><a href="namespaceFoam.html#ad20c8f17b81fbe92f6dd235121ca1de9">Foam::Pout</a></div><div class="ttdeci">prefixOSstream Pout</div><div class="ttdoc">An Ostream wrapper for parallel output to std::cout. </div></div>
<div class="ttc" id="namespaceFoam_html_a7e96c2b6f66f356ef358f08e65cb8ace"><div class="ttname"><a href="namespaceFoam.html#a7e96c2b6f66f356ef358f08e65cb8ace">Foam::magSqr</a></div><div class="ttdeci">dimensioned&lt; typename typeOfMag&lt; Type &gt;::type &gt; magSqr(const dimensioned&lt; Type &gt; &amp;dt)</div></div>
<div class="ttc" id="classFoam_1_1mapPolyMesh_html_aa51573bc757d5d5bb058db0464886447"><div class="ttname"><a href="classFoam_1_1mapPolyMesh.html#aa51573bc757d5d5bb058db0464886447">Foam::mapPolyMesh::mesh</a></div><div class="ttdeci">const polyMesh &amp; mesh() const </div><div class="ttdoc">Return polyMesh. </div><div class="ttdef"><b>Definition:</b> <a href="mapPolyMesh_8H_source.html#l00436">mapPolyMesh.H:436</a></div></div>
<div class="ttc" id="classFoam_1_1syncTools_html_ab59012dece791b34a5780b0771f8c9b5"><div class="ttname"><a href="classFoam_1_1syncTools.html#ab59012dece791b34a5780b0771f8c9b5">Foam::syncTools::swapBoundaryFaceList</a></div><div class="ttdeci">static void swapBoundaryFaceList(const polyMesh &amp;mesh, UList&lt; T &gt; &amp;faceValues)</div><div class="ttdoc">Swap coupled boundary face values. Uses eqOp. </div><div class="ttdef"><b>Definition:</b> <a href="syncTools_8H_source.html#l00479">syncTools.H:479</a></div></div>
<div class="ttc" id="faceSet_8H_html"><div class="ttname"><a href="faceSet_8H.html">faceSet.H</a></div></div>
<div class="ttc" id="namespaceFoam_html_ab64e5584854aaf645dab58faf8793d20"><div class="ttname"><a href="namespaceFoam.html#ab64e5584854aaf645dab58faf8793d20">Foam::Zero</a></div><div class="ttdeci">static constexpr const zero Zero</div><div class="ttdoc">Global zero. </div><div class="ttdef"><b>Definition:</b> <a href="zero_8H_source.html#l00146">zero.H:146</a></div></div>
<div class="ttc" id="refinementSurfaces_8H_html"><div class="ttname"><a href="refinementSurfaces_8H.html">refinementSurfaces.H</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<hr class="footer"/>
  <address class="footer">
    <small>
      <p>
        Copyright&nbsp;&copy;&nbsp;2011-2018&nbsp;
        <a href="http://www.openfoam.com">OpenFOAM</a>
        |
        OPENFOAM&reg; is a registered
        <a href="http://www.openfoam.com/legal/trademark-policy.php">trademark
        </a> of OpenCFD Ltd.
      </p>
      <p>
        Generated by &#160;<a href="http://www.doxygen.org/index.html">
        <img class="footer" src="doxygen.png" alt="doxygen"/>
        </a> 1.8.5
      </p>
    </small>
  </address>
<!-- BEGIN MATHJAX-->
<!-- END MATHJAX-->
</body>
</html>
